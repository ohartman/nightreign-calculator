<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nightreign Build Calculator - Stats System</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Pirata+One&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #1a1a24;
            --bg-hover: #252533;
            --gold: #d4af37;
            --gold-dim: #8b7423;
            --crimson: #8b0000;
            --text: #e8e6e3;
            --text-dim: #9a9896;
            --border: #2a2a3a;
        }

        body {
            font-family: 'Crimson Text', serif;
            background: 
                radial-gradient(ellipse at top, rgba(139,0,0,0.15), transparent 50%),
                radial-gradient(ellipse at bottom, rgba(212,175,55,0.1), transparent 50%),
                linear-gradient(135deg, var(--bg-dark) 0%, #151520 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 20px 10px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 3px solid var(--gold);
            position: relative;
        }

        .title {
            font-family: 'Pirata One', cursive;
            font-size: clamp(36px, 8vw, 72px);
            font-weight: 400;
            color: var(--gold);
            text-shadow: 
                0 0 30px rgba(212, 175, 55, 0.6),
                0 0 60px rgba(212, 175, 55, 0.3),
                0 4px 8px rgba(0,0,0,0.5);
            margin-bottom: 10px;
            letter-spacing: 3px;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from { 
                text-shadow: 
                    0 0 20px rgba(212, 175, 55, 0.4),
                    0 0 40px rgba(212, 175, 55, 0.2),
                    0 4px 8px rgba(0,0,0,0.5);
            }
            to { 
                text-shadow: 
                    0 0 40px rgba(212, 175, 55, 0.8),
                    0 0 80px rgba(212, 175, 55, 0.4),
                    0 4px 8px rgba(0,0,0,0.5);
            }
        }

        .subtitle {
            font-size: 18px;
            color: var(--text-dim);
            font-style: italic;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .card {
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(26,26,36,0.95) 100%);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
            opacity: 0.6;
        }

        .card-title {
            font-family: 'Cinzel', serif;
            font-size: 26px;
            color: var(--gold);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .character-btn {
            font-family: 'Crimson Text', serif;
            padding: 16px 10px;
            background: linear-gradient(135deg, var(--bg-card), rgba(26,26,36,0.9));
            border: 2px solid var(--border);
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            text-align: center;
            min-height: 60px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .character-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(212,175,55,0.2), transparent);
            transform: translate(-50%, -50%);
            transition: all 0.5s;
        }

        .character-btn:hover::before {
            width: 200%;
            height: 200%;
        }

        .character-btn:hover {
            background: var(--bg-hover);
            border-color: var(--gold-dim);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
        }

        .character-btn.active {
            background: linear-gradient(135deg, var(--crimson), #a01010);
            border-color: var(--gold);
            box-shadow: 
                0 0 30px rgba(139, 0, 0, 0.7),
                0 0 60px rgba(139, 0, 0, 0.4),
                0 8px 24px rgba(0,0,0,0.6);
            transform: scale(1.05);
        }

        .dlc-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            font-size: 9px;
            padding: 3px 6px;
            border-radius: 4px;
            margin-left: 6px;
            font-weight: 900;
            letter-spacing: 0.5px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
        }

        .level-control {
            margin: 24px 0;
        }

        .level-display {
            font-family: 'Cinzel', serif;
            font-size: 48px;
            color: var(--gold);
            text-align: center;
            margin-bottom: 16px;
            text-shadow: 
                0 0 20px rgba(212, 175, 55, 0.5),
                0 4px 8px rgba(0,0,0,0.5);
            font-weight: 700;
        }

        .level-markers {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 13px;
            color: var(--text-dim);
            padding: 0 8px;
            font-family: 'Cinzel', serif;
        }

        .softcap-marker {
            position: relative;
            color: #ff8c00;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(255, 140, 0, 0.5);
        }

        .slider-container {
            position: relative;
            padding: 10px 0;
        }

        .slider {
            width: 100%;
            height: 12px;
            border-radius: 6px;
            background: linear-gradient(90deg, 
                var(--bg-hover) 0%, 
                var(--bg-hover) 55%, 
                rgba(255,140,0,0.3) 55%, 
                rgba(255,140,0,0.3) 100%
            );
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--gold), var(--gold-dim));
            cursor: pointer;
            box-shadow: 
                0 0 20px rgba(212, 175, 55, 0.7),
                0 4px 8px rgba(0,0,0,0.4);
            transition: all 0.2s;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 
                0 0 30px rgba(212, 175, 55, 0.9),
                0 6px 12px rgba(0,0,0,0.5);
        }

        .slider::-moz-range-thumb {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--gold), var(--gold-dim));
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 
                0 0 20px rgba(212, 175, 55, 0.7),
                0 4px 8px rgba(0,0,0,0.4);
        }

        .stats-section {
            margin-bottom: 30px;
        }

        .section-header {
            font-family: 'Cinzel', serif;
            font-size: 20px;
            color: var(--gold);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 14px;
        }

        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 14px;
            margin-bottom: 30px;
        }

        .stat-item {
            background: linear-gradient(135deg, var(--bg-hover), rgba(37,37,51,0.9));
            padding: 16px;
            border-radius: 8px;
            border-left: 5px solid var(--gold);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(212,175,55,0.05));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stat-item:hover::before {
            opacity: 1;
        }

        .stat-item:hover {
            transform: translateX(6px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
            border-left-color: var(--gold);
        }

        .stat-item.hp { border-left-color: #ff4444; }
        .stat-item.fp { border-left-color: #4488ff; }
        .stat-item.stamina { border-left-color: #44ff44; }

        .stat-name {
            font-family: 'Cinzel', serif;
            font-size: 12px;
            color: var(--text-dim);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--gold);
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 2px 6px rgba(0,0,0,0.4);
            line-height: 1;
        }

        .stat-badge {
            display: inline-block;
            padding: 4px 9px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            letter-spacing: 0.5px;
        }

        .badge-S {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.5);
        }

        .badge-A {
            background: linear-gradient(135deg, #44ff44, #00cc00);
            box-shadow: 0 0 15px rgba(68, 255, 68, 0.5);
            color: #000;
        }

        .badge-B {
            background: linear-gradient(135deg, #4488ff, #0066cc);
            box-shadow: 0 0 15px rgba(68, 136, 255, 0.5);
        }

        .badge-C {
            background: linear-gradient(135deg, #ffaa44, #ff8800);
            box-shadow: 0 0 15px rgba(255, 170, 68, 0.5);
            color: #000;
        }

        .badge-D {
            background: linear-gradient(135deg, #aa44ff, #8800cc);
            box-shadow: 0 0 15px rgba(170, 68, 255, 0.5);
        }

        .softcap-info {
            background: linear-gradient(135deg, rgba(255,140,0,0.2), rgba(255,140,0,0.08));
            border-left: 5px solid #ff8c00;
            padding: 18px;
            margin-top: 20px;
            font-size: 15px;
            border-radius: 8px;
            line-height: 1.7;
            box-shadow: 0 4px 12px rgba(255,140,0,0.2);
        }

        .softcap-info strong {
            color: #ff8c00;
            font-size: 17px;
            display: block;
            margin-bottom: 8px;
            font-family: 'Cinzel', serif;
            text-shadow: 0 0 10px rgba(255,140,0,0.5);
        }

        .abilities-section {
            background: var(--bg-hover);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 2px solid var(--border);
        }

        .ability-item {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .ability-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .ability-label {
            font-family: 'Cinzel', serif;
            font-size: 14px;
            color: var(--gold);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .ability-text {
            font-size: 15px;
            color: var(--text);
            line-height: 1.6;
        }

        .btn {
            padding: 16px 32px;
            background: linear-gradient(135deg, var(--gold-dim), var(--gold));
            border: none;
            color: var(--bg-dark);
            font-family: 'Cinzel', serif;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
            min-height: 56px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 35px rgba(212, 175, 55, 0.6);
        }

        .btn:active {
            transform: translateY(-2px);
        }

        .share-section {
            text-align: center;
            margin: 40px 0;
        }

        .share-success {
            background: linear-gradient(135deg, rgba(68,255,68,0.2), rgba(0,204,0,0.1));
            border: 2px solid #00cc00;
            padding: 12px 20px;
            border-radius: 8px;
            margin-top: 12px;
            display: inline-block;
            font-size: 14px;
            color: #00ff00;
            box-shadow: 0 0 20px rgba(0,255,0,0.3);
        }

        @media (max-width: 768px) {
            .character-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-grid, .resource-grid {
                grid-template-columns: 1fr;
            }

            .title {
                font-size: 32px;
            }

            .level-display {
                font-size: 36px;
            }

            .card {
                padding: 18px;
            }
        }

        @media (max-width: 480px) {
            .character-btn {
                font-size: 14px;
                padding: 12px 8px;
            }

            .stat-value {
                font-size: 26px;
            }

            .card-title {
                font-size: 22px;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    
        /* ============================================ */
        /* TABS SYSTEM */
        /* ============================================ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }

        .tab-btn {
            font-family: 'Cinzel', serif;
            padding: 14px 24px;
            background: linear-gradient(135deg, var(--bg-card), rgba(26,26,36,0.9));
            border: 2px solid var(--border);
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 15px;
            font-weight: 600;
            border-radius: 8px;
            min-height: 56px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background: var(--bg-hover);
            border-color: var(--gold-dim);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--gold-dim), var(--gold));
            border-color: var(--gold);
            color: var(--bg-dark);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.5);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ============================================ */
        /* WEAPON DATABASE */
        /* ============================================ */
        .weapon-filters {
            margin-bottom: 24px;
        }

        .search-box {
            width: 100%;
            padding: 14px 20px;
            background: var(--bg-hover);
            border: 2px solid var(--border);
            color: var(--text);
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Crimson Text', serif;
            margin-bottom: 16px;
            transition: all 0.3s;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .filter-btn {
            padding: 10px 18px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            font-family: 'Crimson Text', serif;
            font-weight: 600;
            border-radius: 6px;
            min-height: 44px;
        }

        .filter-btn:hover {
            background: var(--bg-hover);
            border-color: var(--gold-dim);
        }

        .filter-btn.active {
            border-color: var(--gold);
            background: var(--bg-hover);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }

        .legendary-btn.active {
            border-color: #fbbf24;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }

        .rare-btn.active {
            border-color: #a855f7;
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.5);
        }

        .uncommon-btn.active {
            border-color: #60a5fa;
            box-shadow: 0 0 20px rgba(96, 165, 250, 0.5);
        }

        .weapon-count {
            font-family: 'Cinzel', serif;
            font-size: 14px;
            color: var(--text-dim);
            margin-bottom: 20px;
            text-align: center;
        }

        .weapon-list {
            display: grid;
            gap: 16px;
        }

        .weapon-item {
            background: linear-gradient(135deg, var(--bg-hover), rgba(37,37,51,0.9));
            border-left: 6px solid #9ca3af;
            padding: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .weapon-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(212,175,55,0.05));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .weapon-item:hover::before {
            opacity: 1;
        }

        .weapon-item:hover {
            transform: translateX(8px);
            box-shadow: 0 8px 28px rgba(0,0,0,0.5);
        }

        .weapon-item.legendary {
            border-left-color: #fbbf24;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.2);
        }

        .weapon-item.rare {
            border-left-color: #a855f7;
        }

        .weapon-item.uncommon {
            border-left-color: #60a5fa;
        }

        .weapon-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
            gap: 12px;
        }

        .weapon-name {
            font-family: 'Cinzel', serif;
            font-size: 19px;
            color: var(--gold);
            margin-bottom: 4px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            flex: 1;
        }

        .weapon-rarity {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .weapon-rarity.legendary {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #000;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.5);
        }

        .weapon-rarity.rare {
            background: linear-gradient(135deg, #a855f7, #9333ea);
            color: #fff;
        }

        .weapon-rarity.uncommon {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            color: #fff;
        }

        .weapon-type {
            font-size: 13px;
            color: var(--text-dim);
            margin-bottom: 10px;
        }

        .weapon-req {
            font-size: 12px;
            color: #60a5fa;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .weapon-scaling {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .scaling-badge {
            padding: 5px 10px;
            background: var(--bg-card);
            border-radius: 5px;
            font-size: 11px;
            font-weight: 600;
            border: 1px solid var(--border);
        }

        .weapon-damage {
            font-size: 14px;
            color: var(--crimson);
            margin-bottom: 10px;
            font-weight: 700;
        }

        .weapon-effects {
            font-size: 13px;
            color: var(--text);
            line-height: 1.6;
            font-style: italic;
            padding: 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            margin-top: 10px;
        }

        .recommended-weapons {
            display: grid;
            gap: 16px;
        }

        .rec-weapon-note {
            background: rgba(212,175,55,0.1);
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid var(--gold);
            font-size: 13px;
            margin-top: 8px;
        }

        /* ============================================ */
        /* DAMAGE CALCULATOR */
        /* ============================================ */
        .damage-calc {
            background: var(--bg-hover);
            padding: 24px;
            border-radius: 8px;
            border: 2px solid var(--border);
        }

        .calc-inputs {
            margin-bottom: 24px;
        }

        .calc-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .calc-field label {
            display: block;
            font-family: 'Cinzel', serif;
            font-size: 13px;
            color: var(--text-dim);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .calc-field input,
        .calc-field select {
            width: 100%;
            padding: 12px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            color: var(--text);
            border-radius: 6px;
            font-size: 15px;
            font-family: 'Crimson Text', serif;
            transition: all 0.3s;
        }

        .calc-field input:focus,
        .calc-field select:focus {
            outline: none;
            border-color: var(--gold);
        }

        .damage-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
        }

        .damage-output {
            background: linear-gradient(135deg, var(--crimson), #a01010);
            padding: 24px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 8px 28px rgba(139, 0, 0, 0.5);
            border: 2px solid rgba(212, 175, 55, 0.3);
        }

        .damage-label {
            font-family: 'Cinzel', serif;
            font-size: 12px;
            color: var(--text-dim);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .damage-number {
            font-family: 'Cinzel', serif;
            font-size: 48px;
            color: var(--gold);
            font-weight: 900;
            text-shadow: 
                0 0 30px rgba(212, 175, 55, 0.8),
                0 4px 8px rgba(0,0,0,0.5);
            line-height: 1;
        }

        .damage-number.dps {
            font-size: 42px;
        }

        /* Mobile Navigation Dropdown */
        .mobile-nav {
            display: none;
            margin-bottom: 30px;
        }

        .mobile-nav-select {
            width: 100%;
            font-family: 'Cinzel', serif;
            padding: 16px 20px;
            background: linear-gradient(135deg, var(--bg-card), rgba(26,26,36,0.9));
            border: 2px solid var(--gold);
            color: var(--gold);
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23d4af37' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 45px;
        }

        .mobile-nav-select:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.6);
        }

        .mobile-nav-select option {
            background: var(--bg-dark);
            color: var(--text);
            padding: 12px;
        }

        @media (max-width: 768px) {
            .tabs {
                display: none !important;
            }

            .mobile-nav {
                display: block;
            }

            .filter-buttons {
                gap: 6px;
            }

            .filter-btn {
                padding: 8px 14px;
                font-size: 12px;
            }

            .calc-row {
                grid-template-columns: 1fr;
            }

            .damage-results {
                grid-template-columns: 1fr;
            }
        }

    
        /* ============================================ */
        /* BOSS INTELLIGENCE SYSTEM */
        /* ============================================ */
        .boss-filters {
            margin-bottom: 24px;
        }

        .boss-count {
            font-family: 'Cinzel', serif;
            font-size: 14px;
            color: var(--text-dim);
            margin-bottom: 20px;
            text-align: center;
        }

        .boss-grid {
            display: grid;
            gap: 20px;
        }

        .boss-item {
            background: linear-gradient(135deg, var(--bg-hover), rgba(37,37,51,0.9));
            padding: 24px;
            border-radius: 10px;
            border-left: 6px solid var(--crimson);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .boss-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(139,0,0,0.1));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .boss-item:hover::before {
            opacity: 1;
        }

        .boss-item:hover {
            transform: scale(1.02);
            box-shadow: 0 12px 36px rgba(139, 0, 0, 0.4);
        }

        .boss-item.nightlord {
            border-left-color: #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }

        .boss-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
            gap: 16px;
        }

        .boss-name {
            font-family: 'Cinzel', serif;
            font-size: 24px;
            color: var(--gold);
            margin-bottom: 6px;
            text-shadow: 0 2px 6px rgba(0,0,0,0.5);
            flex: 1;
        }

        .boss-difficulty {
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .boss-difficulty.nightlord {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

        .boss-difficulty.hard {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            color: #fff;
        }

        .boss-difficulty.medium {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #000;
        }

        .boss-type {
            font-size: 14px;
            color: var(--text-dim);
            margin-bottom: 16px;
            font-style: italic;
        }

        .weakness-section {
            margin-bottom: 16px;
        }

        .weakness-label {
            font-family: 'Cinzel', serif;
            font-size: 13px;
            color: var(--gold);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .weakness-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .weakness-tag {
            padding: 7px 13px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .weakness-tag.fire {
            background: linear-gradient(135deg, #ff6b1a, #ff4500);
            color: #fff;
            box-shadow: 0 0 15px rgba(255, 107, 26, 0.5);
        }

        .weakness-tag.lightning {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .weakness-tag.holy {
            background: linear-gradient(135deg, #ffe680, #ffd700);
            color: #000;
            box-shadow: 0 0 15px rgba(255, 230, 128, 0.5);
        }

        .weakness-tag.magic {
            background: linear-gradient(135deg, #5b9fff, #3b82f6);
            color: #fff;
            box-shadow: 0 0 15px rgba(91, 159, 255, 0.5);
        }

        .weakness-tag.poison {
            background: linear-gradient(135deg, #6b8f22, #4a6b17);
            color: #fff;
        }

        .weakness-tag.bleed {
            background: linear-gradient(135deg, #dc143c, #8b0000);
            color: #fff;
            box-shadow: 0 0 15px rgba(220, 20, 60, 0.5);
        }

        .weakness-tag.frost {
            background: linear-gradient(135deg, #4db8ff, #00bfff);
            color: #000;
            box-shadow: 0 0 15px rgba(77, 184, 255, 0.5);
        }

        .weakness-tag.sleep {
            background: linear-gradient(135deg, #9370db, #8a2be2);
            color: #fff;
        }

        .resistance-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .resistance-tag {
            padding: 6px 11px;
            border-radius: 5px;
            font-size: 10px;
            font-weight: 600;
            background: rgba(139, 0, 0, 0.3);
            border: 1px solid var(--crimson);
            color: var(--text-dim);
        }

        .boss-strategy {
            background: rgba(0,0,0,0.3);
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
            border-left: 4px solid var(--gold);
        }

        .strategy-section {
            margin-bottom: 14px;
        }

        .strategy-section:last-child {
            margin-bottom: 0;
        }

        .strategy-title {
            font-family: 'Cinzel', serif;
            font-size: 14px;
            color: var(--gold);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .strategy-text {
            font-size: 14px;
            color: var(--text);
            line-height: 1.7;
        }

        .best-chars {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .char-tag {
            padding: 6px 12px;
            background: linear-gradient(135deg, var(--gold-dim), var(--gold));
            color: var(--bg-dark);
            border-radius: 5px;
            font-size: 11px;
            font-weight: 700;
            box-shadow: 0 2px 6px rgba(212, 175, 55, 0.4);
        }

        /* Boss Counter Builder */
        .boss-counter {
            background: var(--bg-hover);
            padding: 24px;
            border-radius: 8px;
            border: 2px solid var(--border);
        }

        .counter-select {
            margin-bottom: 24px;
        }

        .counter-select label {
            display: block;
            font-family: 'Cinzel', serif;
            font-size: 14px;
            color: var(--text-dim);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .counter-select select {
            width: 100%;
            padding: 14px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            color: var(--text);
            border-radius: 6px;
            font-size: 16px;
            font-family: 'Crimson Text', serif;
            cursor: pointer;
        }

        .counter-display {
            display: grid;
            gap: 20px;
        }

        .counter-section {
            background: var(--bg-card);
            padding: 18px;
            border-radius: 8px;
            border-left: 4px solid var(--gold);
        }

        .counter-section-title {
            font-family: 'Cinzel', serif;
            font-size: 16px;
            color: var(--gold);
            margin-bottom: 12px;
            text-transform: uppercase;
        }

        .counter-item {
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 14px;
            line-height: 1.6;
        }

        .counter-item:last-child {
            margin-bottom: 0;
        }

        .counter-weapon {
            font-weight: 700;
            color: var(--gold);
        }

        @media (max-width: 768px) {
            .boss-header {
                flex-direction: column;
            }

            .weakness-tags, .resistance-tags, .best-chars {
                gap: 6px;
            }
        }

    
        /* ============================================ */
        /* TEAM BUILDER */
        /* ============================================ */
        .team-builder {
            display: grid;
            gap: 24px;
        }

        .team-slots {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .team-slot {
            background: linear-gradient(135deg, var(--bg-hover), rgba(37,37,51,0.9));
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--border);
            transition: all 0.3s;
        }

        .team-slot:hover {
            border-color: var(--gold-dim);
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
        }

        .slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .slot-title {
            font-family: 'Cinzel', serif;
            font-size: 16px;
            color: var(--gold);
            font-weight: 600;
        }

        .role-badge {
            padding: 6px 12px;
            border-radius: 5px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .role-badge.dps {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            color: #fff;
        }

        .role-badge.tank {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: #fff;
        }

        .role-badge.support {
            background: linear-gradient(135deg, #10b981, #047857);
            color: #fff;
        }

        .role-badge.hybrid {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #000;
        }

        .team-select {
            width: 100%;
            padding: 12px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            color: var(--text);
            border-radius: 6px;
            font-size: 15px;
            font-family: 'Crimson Text', serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 14px;
        }

        .team-select:focus {
            outline: none;
            border-color: var(--gold);
        }

        .char-preview {
            font-size: 13px;
            color: var(--text-dim);
            line-height: 1.6;
        }

        .team-analysis {
            background: linear-gradient(135deg, var(--bg-card), rgba(26,26,36,0.95));
            padding: 24px;
            border-radius: 10px;
            border: 2px solid var(--border);
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .analysis-stat {
            background: var(--bg-hover);
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid var(--gold);
        }

        .analysis-label {
            font-family: 'Cinzel', serif;
            font-size: 12px;
            color: var(--text-dim);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .analysis-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--gold);
        }

        .balance-bars {
            margin-top: 20px;
        }

        .balance-bar {
            margin-bottom: 16px;
        }

        .balance-label {
            font-size: 13px;
            color: var(--text);
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
        }

        .balance-track {
            height: 24px;
            background: var(--bg-hover);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .balance-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold-dim), var(--gold));
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            color: var(--bg-dark);
        }

        .synergy-display {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--border);
        }

        .synergy-title {
            font-family: 'Cinzel', serif;
            font-size: 18px;
            color: var(--gold);
            margin-bottom: 16px;
            text-transform: uppercase;
        }

        .synergy-item {
            background: var(--bg-hover);
            padding: 14px;
            border-radius: 6px;
            margin-bottom: 12px;
            border-left: 4px solid var(--gold);
            font-size: 14px;
            line-height: 1.6;
        }

        .synergy-item:last-child {
            margin-bottom: 0;
        }

        .combo-recommendations {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--border);
        }

        .preset-teams {
            display: grid;
            gap: 16px;
        }

        .preset-team {
            background: var(--bg-hover);
            padding: 18px;
            border-radius: 8px;
            border-left: 5px solid var(--gold);
            cursor: pointer;
            transition: all 0.3s;
        }

        .preset-team:hover {
            transform: translateX(6px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .preset-title {
            font-family: 'Cinzel', serif;
            font-size: 16px;
            color: var(--gold);
            margin-bottom: 10px;
        }

        .preset-chars {
            font-size: 14px;
            color: var(--text);
            margin-bottom: 8px;
        }

        .preset-desc {
            font-size: 13px;
            color: var(--text-dim);
            font-style: italic;
        }

        /* ============================================ */
        /* ADVANCED DAMAGE CALCULATOR */
        /* ============================================ */
        .advanced-calc {
            display: grid;
            gap: 24px;
        }

        .calc-section {
            background: var(--bg-hover);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--border);
        }

        .calc-section-title {
            font-family: 'Cinzel', serif;
            font-size: 18px;
            color: var(--gold);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .calc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
        }

        .damage-results-advanced {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            padding: 24px;
            background: linear-gradient(135deg, var(--crimson), #a01010);
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(139, 0, 0, 0.6);
        }

        .result-card {
            background: rgba(0,0,0,0.4);
            padding: 18px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid rgba(212, 175, 55, 0.3);
        }

        .result-card.mega {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, rgba(212,175,55,0.3), rgba(139,116,35,0.3));
            border-color: var(--gold);
        }

        .result-label {
            font-family: 'Cinzel', serif;
            font-size: 11px;
            color: var(--text-dim);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .result-value {
            font-family: 'Cinzel', serif;
            font-size: 32px;
            font-weight: 900;
            color: var(--gold);
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.6);
        }

        .result-value.gold {
            color: #ffd700;
        }

        .result-value.crimson {
            color: #ff6b6b;
        }

        .result-value.mega-value {
            font-size: 56px;
            color: #ffd700;
            text-shadow: 
                0 0 30px rgba(255, 215, 0, 0.8),
                0 0 60px rgba(255, 215, 0, 0.4);
        }

        .calc-breakdown {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--border);
        }

        .breakdown-text {
            font-size: 14px;
            color: var(--text);
            line-height: 1.8;
            font-family: 'Courier New', monospace;
        }

        .breakdown-text strong {
            color: var(--gold);
        }

        @media (max-width: 1024px) {
            .team-slots {
                grid-template-columns: 1fr;
            }

            .analysis-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .calc-grid {
                grid-template-columns: 1fr;
            }

            .damage-results-advanced {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .damage-results-advanced {
                grid-template-columns: 1fr;
            }

            .analysis-grid {
                grid-template-columns: 1fr;
            }
        }

    
        /* ============================================ */
        /* BUILD ARCHETYPES */
        /* ============================================ */
        .archetype-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .archetype-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .archetype-card {
            background: linear-gradient(135deg, var(--bg-hover), rgba(37,37,51,0.9));
            padding: 24px;
            border-radius: 10px;
            border-left: 6px solid var(--gold);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .archetype-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(212,175,55,0.08));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .archetype-card:hover::before {
            opacity: 1;
        }

        .archetype-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 36px rgba(0,0,0,0.5);
            border-left-color: #ffd700;
        }

        .archetype-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .archetype-name {
            font-family: 'Cinzel', serif;
            font-size: 22px;
            color: var(--gold);
            margin-bottom: 6px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .archetype-type {
            padding: 6px 12px;
            border-radius: 5px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            background: rgba(212, 175, 55, 0.2);
            color: var(--gold);
            border: 1px solid var(--gold);
        }

        .archetype-description {
            font-size: 14px;
            color: var(--text);
            margin-bottom: 16px;
            line-height: 1.7;
        }

        .archetype-details {
            background: rgba(0,0,0,0.3);
            padding: 14px;
            border-radius: 6px;
            margin-bottom: 12px;
        }

        .archetype-section {
            margin-bottom: 12px;
        }

        .archetype-section:last-child {
            margin-bottom: 0;
        }

        .archetype-label {
            font-family: 'Cinzel', serif;
            font-size: 12px;
            color: var(--gold);
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .archetype-content {
            font-size: 13px;
            color: var(--text);
            line-height: 1.6;
        }

        .archetype-weapons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 6px;
        }

        .weapon-chip {
            padding: 4px 10px;
            background: var(--bg-card);
            border-radius: 4px;
            font-size: 11px;
            border: 1px solid var(--border);
        }

        /* ============================================ */
        /* RELICS */
        /* ============================================ */
        .relic-priority-info {
            background: rgba(212,175,55,0.1);
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid var(--gold);
            margin-bottom: 24px;
            font-size: 14px;
            line-height: 1.7;
        }

        .priority-sections {
            display: grid;
            gap: 24px;
        }

        .priority-section {
            background: var(--bg-hover);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--border);
        }

        .priority-section.high {
            border-left: 6px solid #dc2626;
        }

        .priority-section.medium {
            border-left: 6px solid #f59e0b;
        }

        .priority-section.low {
            border-left: 6px solid #10b981;
        }

        .priority-title {
            font-family: 'Cinzel', serif;
            font-size: 20px;
            color: var(--gold);
            margin-bottom: 16px;
            text-transform: uppercase;
        }

        .relic-list {
            display: grid;
            gap: 14px;
        }

        .relic-item {
            background: var(--bg-card);
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid var(--gold);
            transition: all 0.3s;
        }

        .relic-item:hover {
            transform: translateX(6px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.4);
        }

        .relic-name {
            font-family: 'Cinzel', serif;
            font-size: 16px;
            color: var(--gold);
            margin-bottom: 8px;
        }

        .relic-effect {
            font-size: 13px;
            color: var(--text);
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .relic-synergy {
            font-size: 12px;
            color: var(--text-dim);
            font-style: italic;
        }

        .evergaol-guide {
            display: grid;
            gap: 16px;
        }

        .evergaol-item {
            background: var(--bg-hover);
            padding: 18px;
            border-radius: 8px;
            border-left: 5px solid var(--gold);
        }

        .evergaol-name {
            font-family: 'Cinzel', serif;
            font-size: 18px;
            color: var(--gold);
            margin-bottom: 12px;
        }

        .evergaol-priority {
            font-size: 14px;
            color: var(--text);
            line-height: 1.7;
        }

        /* ============================================ */
        /* COMPARISON */
        /* ============================================ */
        .comparison-selector {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin-bottom: 24px;
        }

        .compare-slot {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .compare-slot label {
            font-family: 'Cinzel', serif;
            font-size: 14px;
            color: var(--text-dim);
            text-transform: uppercase;
        }

        .compare-slot select {
            width: 100%;
            padding: 12px;
            background: var(--bg-hover);
            border: 2px solid var(--border);
            color: var(--text);
            border-radius: 6px;
            font-size: 16px;
            font-family: 'Crimson Text', serif;
            font-weight: 600;
        }

        .vs-divider {
            font-family: 'Cinzel', serif;
            font-size: 32px;
            font-weight: 900;
            color: var(--crimson);
            text-shadow: 0 0 20px rgba(139, 0, 0, 0.6);
        }

        .comparison-level {
            text-align: center;
            margin-bottom: 30px;
        }

        .comparison-level label {
            display: block;
            font-family: 'Cinzel', serif;
            font-size: 14px;
            color: var(--text-dim);
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .comparison-level input {
            width: 100%;
            max-width: 500px;
            margin: 10px auto;
            display: block;
        }

        .comparison-level span {
            font-size: 24px;
            color: var(--gold);
            font-weight: 700;
        }

        .comparison-display {
            display: grid;
            gap: 24px;
        }

        .comparison-table {
            background: var(--bg-hover);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--border);
        }

        .comparison-row {
            display: grid;
            grid-template-columns: 200px 1fr 1fr;
            border-bottom: 1px solid var(--border);
        }

        .comparison-row:last-child {
            border-bottom: none;
        }

        .comparison-row.header {
            background: linear-gradient(135deg, var(--gold-dim), var(--gold));
        }

        .comparison-cell {
            padding: 14px 18px;
            font-size: 14px;
        }

        .comparison-row.header .comparison-cell {
            font-family: 'Cinzel', serif;
            font-weight: 700;
            color: var(--bg-dark);
            text-transform: uppercase;
            font-size: 13px;
        }

        .comparison-cell.label {
            font-family: 'Cinzel', serif;
            color: var(--gold);
            font-weight: 600;
            background: rgba(0,0,0,0.2);
        }

        .comparison-cell.value {
            text-align: center;
            font-weight: 700;
            color: var(--text);
        }

        .comparison-cell.winner {
            background: rgba(212, 175, 55, 0.2);
            color: var(--gold);
        }

        .comparison-chart {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 10px;
            border: 2px solid var(--border);
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chart-placeholder {
            text-align: center;
            color: var(--text-dim);
            font-size: 14px;
        }

        .stat-bars-comparison {
            display: grid;
            gap: 16px;
        }

        .stat-comparison-item {
            background: var(--bg-card);
            padding: 14px;
            border-radius: 6px;
        }

        .stat-comparison-label {
            font-size: 13px;
            color: var(--text-dim);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }

        .stat-comparison-bars {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-comparison-bar {
            height: 32px;
            background: var(--bg-hover);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .stat-comparison-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold-dim), var(--gold));
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            color: var(--bg-dark);
        }

        @media (max-width: 768px) {
            .comparison-selector {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .vs-divider {
                font-size: 24px;
                text-align: center;
            }

            .comparison-row {
                grid-template-columns: 120px 1fr 1fr;
            }

            .archetype-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ============================================ */
        /* ANIMATIONS & POLISH */
        /* ============================================ */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .loading {
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card.fade-in {
            animation: slideIn 0.5s ease-out;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Better focus states */
        input:focus,
        select:focus,
        button:focus {
            outline: 2px solid var(--gold);
            outline-offset: 2px;
        }

        /* Loading state for async operations */
        .calculating {
            position: relative;
        }

        .calculating::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">NIGHTREIGN</h1>
            <p class="subtitle">Build Calculator - Master Your Nightfarer</p>
        </div>

        <!-- Mobile Navigation Dropdown -->
        <div class="mobile-nav">
            <select class="mobile-nav-select" onchange="switchTabMobile(this.value)">
                <option value="stats"> STATS</option>
                <option value="weapons"> WEAPONS</option>
                <option value="bosses"> BOSSES</option>
                <option value="team"> TEAM</option>
                <option value="advdamage"> CALC</option>
                <option value="archetypes"> BUILDS</option>
                <option value="relics"> RELICS</option>
                <option value="compare"> COMPARE</option>
            </select>
        </div>

                <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('stats')"> STATS</button>
            <button class="tab-btn" onclick="switchTab('weapons')"> WEAPONS</button>
            <button class="tab-btn" onclick="switchTab('bosses')"> BOSSES</button>
            <button class="tab-btn" onclick="switchTab('team')"> TEAM</button>
            <button class="tab-btn" onclick="switchTab('advdamage')"> CALC</button>
            <button class="tab-btn" onclick="switchTab('archetypes')"> BUILDS</button>
            <button class="tab-btn" onclick="switchTab('relics')"> RELICS</button>
            <button class="tab-btn" onclick="switchTab('compare')"> COMPARE</button>
        </div>

        <div id="statsTab" class="tab-content active">
        <div class="card fade-in">
            <h2 class="card-title"> Select Nightfarer</h2>
            <div class="character-grid">
                <button class="character-btn active" onclick="selectCharacter('wylder')">Wylder</button>
                <button class="character-btn" onclick="selectCharacter('guardian')">Guardian</button>
                <button class="character-btn" onclick="selectCharacter('ironeye')">Ironeye</button>
                <button class="character-btn" onclick="selectCharacter('raider')">Raider</button>
                <button class="character-btn" onclick="selectCharacter('recluse')">Recluse</button>
                <button class="character-btn" onclick="selectCharacter('executor')">Executor</button>
                <button class="character-btn" onclick="selectCharacter('duchess')">Duchess</button>
                <button class="character-btn" onclick="selectCharacter('revenant')">Revenant</button>
                <button class="character-btn dlc-char" onclick="selectCharacter('scholar')">Scholar <span class="dlc-badge">DLC</span></button>
                <button class="character-btn dlc-char" onclick="selectCharacter('undertaker')">Undertaker <span class="dlc-badge">DLC</span></button>
            </div>
        </div>

        <div class="card fade-in">
            <h2 class="card-title"> Character Level</h2>
            <div class="level-control">
                <div class="level-display">Level <span id="levelValue">1</span></div>
                <div class="level-markers">
                    <span>Level 1</span>
                    <span class="softcap-marker" title="Soft Cap - Diminishing Returns"> Soft Cap (12)</span>
                    <span>Level 20</span>
                </div>
                <div class="slider-container">
                    <input type="range" min="1" max="20" value="1" class="slider" id="levelSlider" oninput="updateLevel(this.value)">
                </div>
            </div>
            <div id="softcapWarning" class="softcap-info" style="display:none;">
                <strong> SOFT CAP REACHED (Level 12+)</strong>
                Beyond level 12, stat gains are significantly reduced. From a veteran's perspective: focus on finding legendary weapons, optimizing your build synergy, and mastering boss mechanics rather than pure leveling. The difference between level 15 and level 20 is marginal compared to having the right weapon with proper scaling.
            </div>
        </div>

        <div class="card fade-in">
            <h2 class="card-title"> Character Stats - <span id="charName">Wylder</span></h2>
            
            <div class="stats-section">
                <div class="section-header">Resource Stats</div>
                <div class="resource-grid" id="resourceStats">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="stats-section">
                <div class="section-header">Attributes</div>
                <div class="stats-grid" id="attributeStats">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <div class="card fade-in">
            <h2 class="card-title"> Abilities</h2>
            <div class="abilities-section" id="abilitiesDisplay">
                <!-- Populated by JS -->
            </div>
        </div>

                </div>

        <!-- WEAPONS TAB -->
        <div id="weaponsTab" class="tab-content">
            <div class="card fade-in">
                <h2 class="card-title"> Weapon Database</h2>
                <div class="weapon-filters">
                    <input type="text" class="search-box" id="weaponSearch" placeholder=" Search weapons..." oninput="filterWeapons()">
                    <div class="filter-buttons">
                        <button class="filter-btn active" onclick="filterByRarity('all')">All Weapons</button>
                        <button class="filter-btn legendary-btn" onclick="filterByRarity('legendary')"> Legendary</button>
                        <button class="filter-btn rare-btn" onclick="filterByRarity('rare')"> Rare</button>
                        <button class="filter-btn uncommon-btn" onclick="filterByRarity('uncommon')"> Uncommon</button>
                    </div>
                    <div class="filter-buttons">
                        <button class="filter-btn" onclick="filterByType('all')">All Types</button>
                        <button class="filter-btn" onclick="filterByType('greatsword')">Greatswords</button>
                        <button class="filter-btn" onclick="filterByType('katana')">Katanas</button>
                        <button class="filter-btn" onclick="filterByType('staff')">Staves</button>
                        <button class="filter-btn" onclick="filterByType('seal')">Seals</button>
                        <button class="filter-btn" onclick="filterByType('bow')">Bows</button>
                    </div>
                </div>
                <div class="weapon-count">
                    Showing <span id="weaponCount">0</span> weapons
                </div>
                <div class="weapon-list" id="weaponList">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="card fade-in">
                <h2 class="card-title"> Recommended for <span id="recCharName">Wylder</span></h2>
                <div class="recommended-weapons" id="recommendedWeapons">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="card fade-in">
                <h2 class="card-title"> Damage Calculator</h2>
                <div class="damage-calc">
                    <div class="calc-inputs">
                        <div class="calc-row">
                            <div class="calc-field">
                                <label>Select Weapon</label>
                                <select id="calcWeapon" onchange="updateDamageCalc()">
                                    <option value="">Choose a weapon...</option>
                                </select>
                            </div>
                            <div class="calc-field">
                                <label>Character Level</label>
                                <input type="number" id="calcLevel" min="1" max="20" value="1" oninput="updateDamageCalc()" readonly>
                            </div>
                        </div>
                        <div class="calc-row">
                            <div class="calc-field">
                                <label>Buff Multiplier</label>
                                <select id="buffMultiplier" onchange="updateDamageCalc()">
                                    <option value="1.0">None (1.0x)</option>
                                    <option value="1.15">Flame Grant Me Strength (1.15x)</option>
                                    <option value="1.20">Golden Vow (1.20x)</option>
                                    <option value="1.30">Relic Buff (1.30x)</option>
                                    <option value="1.50">Ultimate Art (1.50x)</option>
                                    <option value="1.80">Full Stack (1.80x)</option>
                                </select>
                            </div>
                            <div class="calc-field">
                                <label>Attack Speed (hits/sec)</label>
                                <input type="number" id="attackSpeed" min="0.5" max="3" step="0.1" value="1.5" oninput="updateDamageCalc()">
                            </div>
                        </div>
                    </div>
                    <div class="damage-results">
                        <div class="damage-output">
                            <div class="damage-label">DAMAGE PER HIT</div>
                            <div class="damage-number" id="damagePerHit">0</div>
                        </div>
                        <div class="damage-output">
                            <div class="damage-label">DAMAGE PER SECOND</div>
                            <div class="damage-number dps" id="dpsValue">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- BOSSES TAB -->
        <div id="bossesTab" class="tab-content">
            <div class="card fade-in">
                <h2 class="card-title"> Nightlords & Boss Intelligence</h2>
                <div class="boss-filters">
                    <input type="text" class="search-box" id="bossSearch" placeholder=" Search bosses..." oninput="filterBosses()">
                    <div class="filter-buttons">
                        <button class="filter-btn active" onclick="filterBossDifficulty('all')">All Bosses</button>
                        <button class="filter-btn" onclick="filterBossDifficulty('nightlord')"> Nightlords</button>
                        <button class="filter-btn" onclick="filterBossDifficulty('hard')"> Hard</button>
                        <button class="filter-btn" onclick="filterBossDifficulty('medium')"> Medium</button>
                    </div>
                    <div class="filter-buttons">
                        <button class="filter-btn" onclick="filterBossWeak('all')">All Weaknesses</button>
                        <button class="filter-btn" onclick="filterBossWeak('fire')"> Fire</button>
                        <button class="filter-btn" onclick="filterBossWeak('lightning')"> Lightning</button>
                        <button class="filter-btn" onclick="filterBossWeak('holy')"> Holy</button>
                        <button class="filter-btn" onclick="filterBossWeak('bleed')"> Bleed</button>
                    </div>
                </div>
                <div class="boss-count">
                    Showing <span id="bossCount">0</span> bosses
                </div>
                <div class="boss-grid" id="bossGrid">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="card fade-in">
                <h2 class="card-title"> Boss Counter Builder</h2>
                <div class="boss-counter">
                    <div class="counter-select">
                        <label>Select Boss to Counter</label>
                        <select id="counterBoss" onchange="updateCounterBuild()">
                            <option value="">Choose a boss...</option>
                        </select>
                    </div>
                    <div id="counterDisplay" class="counter-display">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>


        <!-- TEAM BUILDER TAB -->
        <div id="teamTab" class="tab-content">
            <div class="card fade-in">
                <h2 class="card-title"> Team Composition Builder</h2>
                <div class="team-builder">
                    <div class="team-slots">
                        <div class="team-slot">
                            <div class="slot-header">
                                <div class="slot-title">Player 1 (You)</div>
                                <div class="role-badge" id="role1">DPS</div>
                            </div>
                            <select class="team-select" id="player1" onchange="updateTeamAnalysis()">
                                <option value="wylder">Wylder</option>
                                <option value="guardian">Guardian</option>
                                <option value="ironeye">Ironeye</option>
                                <option value="raider">Raider</option>
                                <option value="recluse">Recluse</option>
                                <option value="executor" selected>Executor</option>
                                <option value="duchess">Duchess</option>
                                <option value="revenant">Revenant</option>
                                <option value="scholar">Scholar (DLC)</option>
                                <option value="undertaker">Undertaker (DLC)</option>
                            </select>
                            <div class="char-preview" id="preview1">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        <div class="team-slot">
                            <div class="slot-header">
                                <div class="slot-title">Player 2</div>
                                <div class="role-badge" id="role2">SUPPORT</div>
                            </div>
                            <select class="team-select" id="player2" onchange="updateTeamAnalysis()">
                                <option value="wylder">Wylder</option>
                                <option value="guardian">Guardian</option>
                                <option value="ironeye" selected>Ironeye</option>
                                <option value="raider">Raider</option>
                                <option value="recluse">Recluse</option>
                                <option value="executor">Executor</option>
                                <option value="duchess">Duchess</option>
                                <option value="revenant">Revenant</option>
                                <option value="scholar">Scholar (DLC)</option>
                                <option value="undertaker">Undertaker (DLC)</option>
                            </select>
                            <div class="char-preview" id="preview2">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        <div class="team-slot">
                            <div class="slot-header">
                                <div class="slot-title">Player 3</div>
                                <div class="role-badge" id="role3">TANK</div>
                            </div>
                            <select class="team-select" id="player3" onchange="updateTeamAnalysis()">
                                <option value="wylder">Wylder</option>
                                <option value="guardian" selected>Guardian</option>
                                <option value="ironeye">Ironeye</option>
                                <option value="raider">Raider</option>
                                <option value="recluse">Recluse</option>
                                <option value="executor">Executor</option>
                                <option value="duchess">Duchess</option>
                                <option value="revenant">Revenant</option>
                                <option value="scholar">Scholar (DLC)</option>
                                <option value="undertaker">Undertaker (DLC)</option>
                            </select>
                            <div class="char-preview" id="preview3">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>

                    <div class="team-analysis" id="teamAnalysis">
                        <!-- Populated by JS -->
                    </div>

                    <div class="synergy-display">
                        <div class="synergy-title"> Team Synergies</div>
                        <div id="synergyList">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <div class="combo-recommendations">
                        <div class="synergy-title"> Recommended Team Combos</div>
                        <div class="preset-teams" id="presetTeams">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADVANCED DAMAGE CALCULATOR TAB -->
        <div id="advdamageTab" class="tab-content">
            <div class="card fade-in">
                <h2 class="card-title"> Advanced Damage Calculator</h2>
                <div class="advanced-calc">
                    <div class="calc-section">
                        <h3 class="calc-section-title"> Weapon Configuration</h3>
                        <div class="calc-grid">
                            <div class="calc-field">
                                <label>Select Weapon</label>
                                <select id="advWeapon" onchange="updateAdvCalc()">
                                    <option value="">Choose weapon...</option>
                                </select>
                            </div>
                            <div class="calc-field">
                                <label>Weapon Base Damage</label>
                                <input type="number" id="advBaseDmg" value="300" min="0" oninput="updateAdvCalc()">
                            </div>
                            <div class="calc-field">
                                <label>Primary Scaling Stat</label>
                                <select id="advScalingStat" onchange="updateAdvCalc()">
                                    <option value="strength">Strength</option>
                                    <option value="dexterity" selected>Dexterity</option>
                                    <option value="intelligence">Intelligence</option>
                                    <option value="faith">Faith</option>
                                    <option value="arcane">Arcane</option>
                                </select>
                            </div>
                            <div class="calc-field">
                                <label>Scaling Grade</label>
                                <select id="advScalingGrade" onchange="updateAdvCalc()">
                                    <option value="S">S (2.0x)</option>
                                    <option value="A">A (1.8x)</option>
                                    <option value="B" selected>B (1.4x)</option>
                                    <option value="C">C (1.0x)</option>
                                    <option value="D">D (0.6x)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="calc-section">
                        <h3 class="calc-section-title"> Character Stats</h3>
                        <div class="calc-grid">
                            <div class="calc-field">
                                <label>Character Level</label>
                                <input type="number" id="advCharLevel" value="12" min="1" max="20" oninput="updateAdvCalc()">
                            </div>
                            <div class="calc-field">
                                <label>Stat Value (Auto from level)</label>
                                <input type="number" id="advStatValue" value="30" readonly>
                            </div>
                        </div>
                    </div>

                    <div class="calc-section">
                        <h3 class="calc-section-title"> Buffs & Modifiers</h3>
                        <div class="calc-grid">
                            <div class="calc-field">
                                <label>Team Buff (Raider Totem)</label>
                                <select id="advTeamBuff" onchange="updateAdvCalc()">
                                    <option value="1.0">None (1.0x)</option>
                                    <option value="1.30">War Cry (1.30x)</option>
                                    <option value="1.60" selected>Warlord Totem (1.60x)</option>
                                </select>
                            </div>
                            <div class="calc-field">
                                <label>Personal Buff</label>
                                <select id="advPersonalBuff" onchange="updateAdvCalc()">
                                    <option value="1.0" selected>None (1.0x)</option>
                                    <option value="1.15">Flame Grant Strength (1.15x)</option>
                                    <option value="1.20">Golden Vow (1.20x)</option>
                                    <option value="1.50">Ultimate Art (1.50x)</option>
                                </select>
                            </div>
                            <div class="calc-field">
                                <label>Relic Damage Bonus</label>
                                <select id="advRelicBonus" onchange="updateAdvCalc()">
                                    <option value="1.0" selected>None (1.0x)</option>
                                    <option value="1.10">Minor Relic (1.10x)</option>
                                    <option value="1.20">Major Relic (1.20x)</option>
                                    <option value="1.35">Legendary Relic (1.35x)</option>
                                </select>
                            </div>
                            <div class="calc-field">
                                <label>Counter Buff (Weakness)</label>
                                <select id="advCounterBuff" onchange="updateAdvCalc()">
                                    <option value="1.0" selected>Normal (1.0x)</option>
                                    <option value="1.30">Weakness Hit (1.30x)</option>
                                    <option value="1.50">Critical Weakness (1.50x)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="calc-section">
                        <h3 class="calc-section-title"> Attack Configuration</h3>
                        <div class="calc-grid">
                            <div class="calc-field">
                                <label>Attack Speed (hits/sec)</label>
                                <input type="number" id="advAtkSpeed" value="1.8" min="0.5" max="4" step="0.1" oninput="updateAdvCalc()">
                            </div>
                            <div class="calc-field">
                                <label>Critical Hit Chance %</label>
                                <input type="number" id="advCritChance" value="20" min="0" max="100" oninput="updateAdvCalc()">
                            </div>
                            <div class="calc-field">
                                <label>Critical Multiplier</label>
                                <input type="number" id="advCritMult" value="1.5" min="1" max="3" step="0.1" oninput="updateAdvCalc()">
                            </div>
                            <div class="calc-field">
                                <label>Boss Resistance Modifier</label>
                                <select id="advBossRes" onchange="updateAdvCalc()">
                                    <option value="1.0" selected>Normal (1.0x)</option>
                                    <option value="0.80">Resistant (0.8x)</option>
                                    <option value="0.50">High Resistance (0.5x)</option>
                                    <option value="0.30">Immune-like (0.3x)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="damage-results-advanced">
                        <div class="result-card">
                            <div class="result-label">BASE DAMAGE</div>
                            <div class="result-value" id="advResultBase">0</div>
                        </div>
                        <div class="result-card">
                            <div class="result-label">SCALED DAMAGE</div>
                            <div class="result-value" id="advResultScaled">0</div>
                        </div>
                        <div class="result-card">
                            <div class="result-label">BUFFED DAMAGE</div>
                            <div class="result-value gold" id="advResultBuffed">0</div>
                        </div>
                        <div class="result-card">
                            <div class="result-label">FINAL DAMAGE (vs Boss)</div>
                            <div class="result-value crimson" id="advResultFinal">0</div>
                        </div>
                        <div class="result-card">
                            <div class="result-label">AVG DMG (with Crits)</div>
                            <div class="result-value gold" id="advResultAvg">0</div>
                        </div>
                        <div class="result-card mega">
                            <div class="result-label">DAMAGE PER SECOND</div>
                            <div class="result-value mega-value" id="advResultDPS">0</div>
                        </div>
                    </div>

                    <div class="calc-breakdown">
                        <h3 class="calc-section-title"> Calculation Breakdown</h3>
                        <div id="calcBreakdown" class="breakdown-text">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- BUILD ARCHETYPES TAB -->
        <div id="archetypesTab" class="tab-content">
            <div class="card fade-in">
                <h2 class="card-title"> Build Archetypes</h2>
                <div class="archetype-filter">
                    <button class="filter-btn active" onclick="filterArchetypes('all')">All Builds</button>
                    <button class="filter-btn" onclick="filterArchetypes('pure')">Pure Stats</button>
                    <button class="filter-btn" onclick="filterArchetypes('status')">Status Effects</button>
                    <button class="filter-btn" onclick="filterArchetypes('hybrid')">Hybrids</button>
                </div>
                <div class="archetype-grid" id="archetypeGrid">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <!-- RELICS TAB -->
        <div id="relicsTab" class="tab-content">
            <div class="card fade-in">
                <h2 class="card-title"> Relics & Priority Guide</h2>
                <div class="relic-priority-info">
                    <p><strong>Relics</strong> are powerful items that grant permanent buffs. Prioritize based on your build and the Nightlord you're facing.</p>
                </div>
                <div class="priority-sections">
                    <div class="priority-section high">
                        <h3 class="priority-title"> HIGH PRIORITY - Must Have</h3>
                        <div id="highPriorityRelics" class="relic-list">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="priority-section medium">
                        <h3 class="priority-title"> MEDIUM PRIORITY - Strong Picks</h3>
                        <div id="mediumPriorityRelics" class="relic-list">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="priority-section low">
                        <h3 class="priority-title"> SITUATIONAL - Niche Uses</h3>
                        <div id="lowPriorityRelics" class="relic-list">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
                <div class="card fade-in" style="margin-top: 30px;">
                    <h2 class="card-title"> Evergaol Priority Tracker</h2>
                    <div class="evergaol-guide">
                        <div class="evergaol-item">
                            <div class="evergaol-name"> Early Game (Levels 1-5)</div>
                            <div class="evergaol-priority">
                                <strong>Priority:</strong> Skip Evergaols. Focus on world exploration and leveling.<br>
                                <strong>Reasoning:</strong> Too weak to handle Evergaol bosses efficiently.
                            </div>
                        </div>
                        <div class="evergaol-item">
                            <div class="evergaol-name"> Mid Game (Levels 6-10)</div>
                            <div class="evergaol-priority">
                                <strong>Priority:</strong> Easy Evergaols only (Crucible Knight, Darriwil).<br>
                                <strong>Reasoning:</strong> Good for rare weapon drops. Avoid Ancient Dragon and Godskin Duo.
                            </div>
                        </div>
                        <div class="evergaol-item">
                            <div class="evergaol-name"> Late Game (Levels 11-15)</div>
                            <div class="evergaol-priority">
                                <strong>Priority:</strong> Farm Ancient Dragon, Godskin Duo, Death Rite Bird.<br>
                                <strong>Reasoning:</strong> Highest legendary drop rates. Essential for Nightlord prep.
                            </div>
                        </div>
                        <div class="evergaol-item">
                            <div class="evergaol-name"> Endgame (Levels 16-20)</div>
                            <div class="evergaol-priority">
                                <strong>Priority:</strong> Speed run Evergaols for relics and consumables.<br>
                                <strong>Reasoning:</strong> Diminishing stat returns. Focus on gear optimization.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- COMPARISON TAB -->
        <div id="compareTab" class="tab-content">
            <div class="card fade-in">
                <h2 class="card-title"> Character Comparison</h2>
                <div class="comparison-selector">
                    <div class="compare-slot">
                        <label>Character 1</label>
                        <select id="compare1" onchange="updateComparison()">
                            <option value="wylder" selected>Wylder</option>
                            <option value="guardian">Guardian</option>
                            <option value="ironeye">Ironeye</option>
                            <option value="raider">Raider</option>
                            <option value="recluse">Recluse</option>
                            <option value="executor">Executor</option>
                            <option value="duchess">Duchess</option>
                            <option value="revenant">Revenant</option>
                            <option value="scholar">Scholar (DLC)</option>
                            <option value="undertaker">Undertaker (DLC)</option>
                        </select>
                    </div>
                    <div class="vs-divider">VS</div>
                    <div class="compare-slot">
                        <label>Character 2</label>
                        <select id="compare2" onchange="updateComparison()">
                            <option value="wylder">Wylder</option>
                            <option value="guardian">Guardian</option>
                            <option value="ironeye">Ironeye</option>
                            <option value="raider">Raider</option>
                            <option value="recluse">Recluse</option>
                            <option value="executor" selected>Executor</option>
                            <option value="duchess">Duchess</option>
                            <option value="revenant">Revenant</option>
                            <option value="scholar">Scholar (DLC)</option>
                            <option value="undertaker">Undertaker (DLC)</option>
                        </select>
                    </div>
                </div>
                <div class="comparison-level">
                    <label>Comparison Level</label>
                    <input type="range" min="1" max="20" value="12" id="compareLevel" oninput="updateComparison()">
                    <span id="compareLevelDisplay">Level 12</span>
                </div>
                <div id="comparisonDisplay" class="comparison-display">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>


<div class="share-section">
            <button class="btn" onclick="shareBuild()"> SHARE BUILD</button>
            <div id="shareSuccess" class="share-success" style="display:none;">
                 Build URL copied to clipboard!
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CHARACTER DATA
        // ============================================
        var characters = {
            wylder: {
                name: "Wylder",
                hp: { base: 800, scaling: "A" },
                fp: { base: 100, scaling: "C" },
                stamina: { base: 120, scaling: "B" },
                stats: {
                    vigor: "A", mind: "C", endurance: "B",
                    strength: "A", dexterity: "B", intelligence: "D",
                    faith: "D", arcane: "C"
                },
                passive: "Relentless - Increased poise damage and stagger resistance",
                skill: "Wild Strike - Devastating heavy AOE attack that sends enemies flying",
                ultimate: "Berserker Rage - Massive damage buff (+50%), attack speed increase, and reduced damage taken for 20 seconds"
            },
            guardian: {
                name: "Guardian",
                hp: { base: 1000, scaling: "S" },
                fp: { base: 80, scaling: "D" },
                stamina: { base: 130, scaling: "A" },
                stats: {
                    vigor: "S", mind: "D", endurance: "A",
                    strength: "B", dexterity: "C", intelligence: "D",
                    faith: "C", arcane: "D"
                },
                passive: "Stalwart - 30% damage reduction when blocking, cannot be guard-broken",
                skill: "Shield Bash - Powerful shield strike that staggers and knocks down enemies",
                ultimate: "Impenetrable Wall - Become invulnerable for 15 seconds, draw all enemy aggro, allies gain 40% damage reduction"
            },
            ironeye: {
                name: "Ironeye",
                hp: { base: 650, scaling: "C" },
                fp: { base: 90, scaling: "B" },
                stamina: { base: 100, scaling: "C" },
                stats: {
                    vigor: "C", mind: "B", endurance: "C",
                    strength: "C", dexterity: "A", intelligence: "D",
                    faith: "D", arcane: "C"
                },
                passive: "Eagle Eye - 50% increased bow range and damage, critical hits from stealth",
                skill: "Mighty Shot - Charged powerful arrow that pierces enemies and deals massive damage",
                ultimate: "Rain of Arrows - Call down a devastating AOE barrage covering a huge area for 10 seconds"
            },
            raider: {
                name: "Raider",
                hp: { base: 750, scaling: "B" },
                fp: { base: 90, scaling: "C" },
                stamina: { base: 115, scaling: "B" },
                stats: {
                    vigor: "B", mind: "C", endurance: "B",
                    strength: "S", dexterity: "C", intelligence: "D",
                    faith: "D", arcane: "C"
                },
                passive: "Pillage - Gain 25% more runes on enemy kills",
                skill: "War Cry - Buff entire team's attack power by 30% for 20 seconds",
                ultimate: "Warlord's Totem - Summon a totem that grants massive team-wide buffs: +60% damage, +40% defense, +30% stamina regen"
            },
            recluse: {
                name: "Recluse",
                hp: { base: 700, scaling: "C" },
                fp: { base: 130, scaling: "A" },
                stamina: { base: 110, scaling: "C" },
                stats: {
                    vigor: "C", mind: "A", endurance: "C",
                    strength: "D", dexterity: "C", intelligence: "S",
                    faith: "D", arcane: "B"
                },
                passive: "Spellweaver - All spells cost 30% less FP, faster casting speed",
                skill: "Comet Azur - Channel a continuous laser beam of magic dealing extreme damage",
                ultimate: "Meteorite of Astel - Summon a massive meteor shower that devastates the battlefield, dealing 800% magic damage"
            },
            executor: {
                name: "Executor",
                hp: { base: 720, scaling: "B" },
                fp: { base: 95, scaling: "C" },
                stamina: { base: 115, scaling: "B" },
                stats: {
                    vigor: "B", mind: "C", endurance: "B",
                    strength: "C", dexterity: "S", intelligence: "D",
                    faith: "D", arcane: "A"
                },
                passive: "Blood Hunter - 50% increased bleed buildup, bleed procs restore 10% HP",
                skill: "Corpse Piler - Unleash a rapid slash combo building massive bleed",
                ultimate: "Sanguine Execution - Life-stealing AOE burst that drains enemies and heals you for 100% of damage dealt"
            },
            duchess: {
                name: "Duchess",
                hp: { base: 680, scaling: "C" },
                fp: { base: 140, scaling: "S" },
                stamina: { base: 105, scaling: "C" },
                stats: {
                    vigor: "C", mind: "S", endurance: "C",
                    strength: "D", dexterity: "C", intelligence: "B",
                    faith: "A", arcane: "C"
                },
                passive: "Divine Grace - All healing effects increased by 50%, heals remove status ailments",
                skill: "Blessing's Boon - Create a healing aura that regenerates HP over 15 seconds",
                ultimate: "Marika's Light - Full party heal to max HP + 60% damage buff + immunity to status effects for 30 seconds"
            },
            revenant: {
                name: "Revenant",
                hp: { base: 700, scaling: "C" },
                fp: { base: 110, scaling: "B" },
                stamina: { base: 110, scaling: "C" },
                stats: {
                    vigor: "C", mind: "B", endurance: "C",
                    strength: "C", dexterity: "C", intelligence: "A",
                    faith: "A", arcane: "B"
                },
                passive: "Spirit Caller - Summons last 100% longer and deal 40% more damage",
                skill: "Ancient Death Rancor - Launch homing skull projectiles that inflict frostbite",
                ultimate: "Army of the Fell - Summon 5 powerful spirit warriors to fight alongside you for 45 seconds"
            },
            scholar: {
                name: "Scholar",
                hp: { base: 800, scaling: "B" },
                fp: { base: 180, scaling: "B" },
                stamina: { base: 100, scaling: "B" },
                stats: {
                    vigor: "B", mind: "B", endurance: "B",
                    strength: "D", dexterity: "C", intelligence: "C",
                    faith: "C", arcane: "S"
                },
                passive: "Bagcraft - Carry more consumables and level them up. Level 2: enhanced effect. Level 3: bonus effect added",
                skill: "Analyze - Study enemies/allies with monocle. Apply buffs to self/allies or debuffs to enemies. Longer observation = stronger effects",
                ultimate: "Communion - Thread nearby enemies/allies. Damage to one threaded enemy damages all. Healing one ally heals all threaded allies",
                dlc: true
            },
            undertaker: {
                name: "Undertaker",
                hp: { base: 900, scaling: "B" },
                fp: { base: 110, scaling: "C" },
                stamina: { base: 95, scaling: "C" },
                stats: {
                    vigor: "B", mind: "C", endurance: "C",
                    strength: "A", dexterity: "D", intelligence: "D",
                    faith: "A", arcane: "C"
                },
                passive: "Confluence - When ally uses Ultimate Art, use your own Ultimate for FREE. Also triggers on evading dark-infused grabs",
                skill: "Trance - Sprint speed without stamina drain, increased toughness + combo power. Full ult gauge: massive buffs + auto-dodge lethal hit",
                ultimate: "Loathsome Hex - Fly toward target dealing massive impact damage. Hits multiple enemies in path. Only costs 2/3 ult gauge",
                dlc: true
            }
        };

        // Scaling multipliers
        var scalingMultipliers = {
            'S': 2.0,
            'A': 1.8,
            'B': 1.4,
            'C': 1.0,
            'D': 0.6
        };

        // Current state
        var currentCharacter = 'wylder';
        var currentLevel = 1;

        // ============================================
        // INITIALIZATION
        // ============================================
        function init() {
            // Check URL parameters
            var urlParams = new URLSearchParams(window.location.search);
            var nf = urlParams.get('nf');
            var lvl = urlParams.get('lvl');

            if (nf && characters[nf]) {
                currentCharacter = nf;
            }

            if (lvl) {
                var level = parseInt(lvl);
                if (level >= 1 && level <= 20) {
                    currentLevel = level;
                    document.getElementById('levelSlider').value = level;
                    document.getElementById('levelValue').textContent = level;
                }
            }

            // Update UI
            updateCharacterSelection();
            updateStats();
            checkSoftCap();
        }

        // ============================================
        // CHARACTER SELECTION
        // ============================================
        function selectCharacter(charId) {
            currentCharacter = charId;
            updateCharacterSelection();
            updateStats();
        }

        function updateCharacterSelection() {
            var buttons = document.querySelectorAll('.character-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }

            var activeButton = Array.from(buttons).find(function(btn) {
                return btn.textContent.toLowerCase() === currentCharacter;
            });

            if (activeButton) {
                activeButton.classList.add('active');
            }

            document.getElementById('charName').textContent = characters[currentCharacter].name;
        }

        // ============================================
        // LEVEL CONTROL
        // ============================================
        function updateLevel(level) {
            currentLevel = parseInt(level);
            document.getElementById('levelValue').textContent = currentLevel;
            updateStats();
            checkSoftCap();
        }

        function checkSoftCap() {
            var warning = document.getElementById('softcapWarning');
            if (currentLevel >= 12) {
                warning.style.display = 'block';
            } else {
                warning.style.display = 'none';
            }
        }

        // ============================================
        // STAT CALCULATIONS
        // ============================================
        function calculateStat(base, scaling) {
            var multiplier = scalingMultipliers[scaling];
            var levelsGained = currentLevel - 1;
            return Math.round(base + (levelsGained * multiplier));
        }

        function calculateHP(base, scaling) {
            var multiplier = scalingMultipliers[scaling];
            var levelsGained = currentLevel - 1;
            return Math.round(base + (levelsGained * 20 * multiplier));
        }

        function calculateFP(base, scaling) {
            var multiplier = scalingMultipliers[scaling];
            var levelsGained = currentLevel - 1;
            return Math.round(base + (levelsGained * 3 * multiplier));
        }

        function calculateStamina(base, scaling) {
            var multiplier = scalingMultipliers[scaling];
            var levelsGained = currentLevel - 1;
            return Math.round(base + (levelsGained * 2 * multiplier));
        }

        // Base attribute values at level 1 for each scaling grade
        var baseAttributes = {
            'S': 15,
            'A': 12,
            'B': 10,
            'C': 8,
            'D': 6
        };

        function calculateAttribute(scaling) {
            var base = baseAttributes[scaling];
            var multiplier = scalingMultipliers[scaling];
            var levelsGained = currentLevel - 1;
            return Math.round(base + (levelsGained * multiplier));
        }

        // ============================================
        // UPDATE STATS DISPLAY
        // ============================================
        function updateStats() {
            var char = characters[currentCharacter];

            // Update resource stats
            var hp = calculateHP(char.hp.base, char.hp.scaling);
            var fp = calculateFP(char.fp.base, char.fp.scaling);
            var stamina = calculateStamina(char.stamina.base, char.stamina.scaling);

            var resourceHTML = 
                '<div class="stat-item hp">' +
                    '<div class="stat-name">Health Points</div>' +
                    '<div class="stat-value">' + hp + '<span class="stat-badge badge-' + char.hp.scaling + '">' + char.hp.scaling + '</span></div>' +
                '</div>' +
                '<div class="stat-item fp">' +
                    '<div class="stat-name">Focus Points</div>' +
                    '<div class="stat-value">' + fp + '<span class="stat-badge badge-' + char.fp.scaling + '">' + char.fp.scaling + '</span></div>' +
                '</div>' +
                '<div class="stat-item stamina">' +
                    '<div class="stat-name">Stamina</div>' +
                    '<div class="stat-value">' + stamina + '<span class="stat-badge badge-' + char.stamina.scaling + '">' + char.stamina.scaling + '</span></div>' +
                '</div>';

            document.getElementById('resourceStats').innerHTML = resourceHTML;

            // Update attribute stats
            var attributeHTML = '';
            var attrNames = {
                vigor: 'Vigor',
                mind: 'Mind',
                endurance: 'Endurance',
                strength: 'Strength',
                dexterity: 'Dexterity',
                intelligence: 'Intelligence',
                faith: 'Faith',
                arcane: 'Arcane'
            };

            for (var attr in char.stats) {
                var scaling = char.stats[attr];
                var value = calculateAttribute(scaling);
                attributeHTML +=
                    '<div class="stat-item">' +
                        '<div class="stat-name">' + attrNames[attr] + '</div>' +
                        '<div class="stat-value">' + value + '<span class="stat-badge badge-' + scaling + '">' + scaling + '</span></div>' +
                    '</div>';
            }

            document.getElementById('attributeStats').innerHTML = attributeHTML;

            // Update abilities
            var abilitiesHTML =
                '<div class="ability-item">' +
                    '<div class="ability-label">Passive Ability</div>' +
                    '<div class="ability-text">' + char.passive + '</div>' +
                '</div>' +
                '<div class="ability-item">' +
                    '<div class="ability-label">Skill</div>' +
                    '<div class="ability-text">' + char.skill + '</div>' +
                '</div>' +
                '<div class="ability-item">' +
                    '<div class="ability-label">Ultimate Art</div>' +
                    '<div class="ability-text">' + char.ultimate + '</div>' +
                '</div>';

            document.getElementById('abilitiesDisplay').innerHTML = abilitiesHTML;
        }

        // ============================================
        // SHARE BUILD
        // ============================================
        function shareBuild() {
            var url = window.location.origin + window.location.pathname + '?nf=' + currentCharacter + '&lvl=' + currentLevel;
            
            // Try to copy to clipboard
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(url).then(function() {
                    showShareSuccess();
                }).catch(function() {
                    fallbackCopy(url);
                });
            } else {
                fallbackCopy(url);
            }
        }

        function fallbackCopy(text) {
            var textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                showShareSuccess();
            } catch (err) {
                alert('Share URL: ' + text);
            }
            
            document.body.removeChild(textArea);
        }

        function showShareSuccess() {
            var success = document.getElementById('shareSuccess');
            success.style.display = 'inline-block';
            setTimeout(function() {
                success.style.display = 'none';
            }, 3000);
        }

        // ============================================
        // RUN ON LOAD
        // ============================================
        
        // ============================================
        // WEAPON DATABASE - 50+ WEAPONS
        // ============================================
        var weapons = [
            // LEGENDARY WEAPONS
            {
                name: "Rivers of Blood",
                type: "Katana",
                rarity: "legendary",
                req: "Level 10",
                damage: 310,
                scaling: { str: "E", dex: "B", int: "-", fai: "-", arc: "S" },
                effects: "Corpse Piler weapon art unleashes rapid blood slashes. Bleed buildup +85. Each hemorrhage proc deals 20% of enemy max HP.",
                tags: ["bleed", "dex", "arcane"],
                chars: ["executor", "raider"]
            },
            {
                name: "Blasphemous Blade",
                type: "Greatsword",
                rarity: "legendary",
                req: "Level 10",
                damage: 340,
                scaling: { str: "D", dex: "D", int: "-", fai: "A", arc: "-" },
                effects: "Taker's Flames skill fires devastating flame wave. Restores 10% HP on enemy kill. Best boss killer.",
                tags: ["fire", "faith", "healing"],
                chars: ["duchess", "wylder", "raider"]
            },
            {
                name: "Dark Moon Greatsword",
                type: "Greatsword",
                rarity: "legendary",
                req: "Level 10",
                damage: 330,
                scaling: { str: "D", dex: "D", int: "S", fai: "-", arc: "-" },
                effects: "Moonlight Greatsword skill. Frost buildup +110. Fires magic waves. Reduces enemy magic resistance by 20%.",
                tags: ["frost", "magic", "intelligence"],
                chars: ["recluse", "revenant"]
            },
            {
                name: "Grafted Blade Greatsword",
                type: "Colossal Sword",
                rarity: "legendary",
                req: "Level 10",
                damage: 380,
                scaling: { str: "S", dex: "D", int: "-", fai: "-", arc: "-" },
                effects: "Oath of Vengeance: +5 to all attributes for 60 seconds. Massive poise damage. Staggers everything.",
                tags: ["strength", "buff", "stagger"],
                chars: ["wylder", "raider", "guardian"]
            },
            {
                name: "Maliketh's Black Blade",
                type: "Colossal Sword",
                rarity: "legendary",
                req: "Level 10",
                damage: 350,
                scaling: { str: "B", dex: "D", int: "-", fai: "A", arc: "-" },
                effects: "Destined Death skill. Reduces enemy max HP by 15%. Holy DOT for 10 seconds. Melts tanky bosses.",
                tags: ["holy", "faith", "dot"],
                chars: ["duchess", "raider", "guardian"]
            },
            {
                name: "Sacred Relic Sword",
                type: "Greatsword",
                rarity: "legendary",
                req: "Level 10",
                damage: 325,
                scaling: { str: "D", dex: "C", int: "-", fai: "A", arc: "-" },
                effects: "Wave of Gold skill. Charged attacks fire holy projectiles without FP cost. +40% rune gain. Best farming weapon.",
                tags: ["holy", "faith", "farming"],
                chars: ["duchess", "executor"]
            },
            {
                name: "Godslayer's Greatsword",
                type: "Greatsword",
                rarity: "legendary",
                req: "Level 10",
                damage: 330,
                scaling: { str: "D", dex: "C", int: "-", fai: "A", arc: "-" },
                effects: "Black Flame Tornado skill. Spin-to-win AOE. Black flame DOT ignores 80% of resistances.",
                tags: ["fire", "faith", "aoe"],
                chars: ["duchess", "wylder", "executor"]
            },
            {
                name: "Ruins Greatsword",
                type: "Colossal Sword",
                rarity: "legendary",
                req: "Level 10",
                damage: 360,
                scaling: { str: "S", dex: "D", int: "B", fai: "-", arc: "-" },
                effects: "Wave of Destruction skill. Gravity magic wave with massive range. Charged attacks create gravitational explosions.",
                tags: ["magic", "strength", "gravity"],
                chars: ["wylder", "recluse", "raider"]
            },
            {
                name: "Starscourge Greatsword",
                type: "Colossal Sword",
                rarity: "legendary",
                req: "Level 10",
                damage: 370,
                scaling: { str: "S", dex: "D", int: "C", fai: "-", arc: "-" },
                effects: "Dual wield colossal swords. Starcaller Cry pulls enemies then AOE slams. Gravity manipulation.",
                tags: ["strength", "magic", "dual"],
                chars: ["wylder", "raider"]
            },
            {
                name: "Axe of Godfrey",
                type: "Colossal Weapon",
                rarity: "legendary",
                req: "Level 10",
                damage: 390,
                scaling: { str: "S", dex: "D", int: "-", fai: "-", arc: "-" },
                effects: "Regal Roar skill. Massive AOE stomp. Highest poise damage in game. One-shots trash mobs.",
                tags: ["strength", "aoe", "stagger"],
                chars: ["wylder", "raider", "guardian"]
            },
            {
                name: "Marika's Hammer",
                type: "Colossal Weapon",
                rarity: "legendary",
                req: "Level 10",
                damage: 375,
                scaling: { str: "A", dex: "-", int: "-", fai: "S", arc: "-" },
                effects: "Gold Breaker skill. Holy AOE explosion. Enemy defense down 20%. Team damage buff 15%.",
                tags: ["holy", "faith", "buff"],
                chars: ["duchess", "guardian", "raider"]
            },
            {
                name: "Mohgwyn's Sacred Spear",
                type: "Great Spear",
                rarity: "legendary",
                req: "Level 10",
                damage: 320,
                scaling: { str: "D", dex: "D", int: "-", fai: "-", arc: "S" },
                effects: "Bloodboon Ritual. Creates blood explosion dealing 400% damage. Heals 5% HP per enemy hit.",
                tags: ["bleed", "arcane", "healing"],
                chars: ["executor", "revenant"]
            },
            {
                name: "Bolt of Gransax",
                type: "Spear",
                rarity: "legendary",
                req: "Level 10",
                damage: 300,
                scaling: { str: "D", dex: "A", int: "-", fai: "-", arc: "-" },
                effects: "Ancient Lightning Spear skill. Hurls massive lightning bolt. Lightning buildup +120. Crits for 3x damage.",
                tags: ["lightning", "dex"],
                chars: ["ironeye", "executor"]
            },
            {
                name: "Dragon King's Cragblade",
                type: "Heavy Thrusting Sword",
                rarity: "legendary",
                req: "Level 10",
                damage: 295,
                scaling: { str: "D", dex: "A", int: "-", fai: "-", arc: "-" },
                effects: "Thundercloud Form. Become lightning, deal 350% damage. Lightning debuff: enemies take 25% more lightning damage.",
                tags: ["lightning", "dex", "transform"],
                chars: ["executor", "ironeye"]
            },
            {
                name: "Eleonora's Poleblade",
                type: "Twinblade",
                rarity: "legendary",
                req: "Level 10",
                damage: 285,
                scaling: { str: "E", dex: "A", int: "-", fai: "-", arc: "A" },
                effects: "Bloodblade Dance. Rapid spinning slashes. Bleed buildup +75. Each hit heals 2% HP.",
                tags: ["bleed", "dex", "arcane"],
                chars: ["executor", "raider"]
            },
            {
                name: "Inseparable Sword",
                type: "Greatsword",
                rarity: "legendary",
                req: "Level 10",
                damage: 335,
                scaling: { str: "C", dex: "C", int: "-", fai: "B", arc: "-" },
                effects: "Sacred Blade projectiles on every swing. Holy damage +40%. Prayer buffs last 50% longer.",
                tags: ["holy", "faith"],
                chars: ["duchess", "guardian"]
            },
            {
                name: "Sword of Night and Flame",
                type: "Straight Sword",
                rarity: "legendary",
                req: "Level 10",
                damage: 280,
                scaling: { str: "D", dex: "D", int: "A", fai: "A", arc: "-" },
                effects: "Dual stance: Comet Azur beam OR Flame Sweep. INT/FAI hybrid perfection. Melts bosses.",
                tags: ["magic", "fire", "hybrid"],
                chars: ["recluse", "duchess", "revenant"]
            },
            {
                name: "Marais Executioner's Sword",
                type: "Greatsword",
                rarity: "legendary",
                req: "Level 10",
                damage: 315,
                scaling: { str: "D", dex: "C", int: "-", fai: "-", arc: "B" },
                effects: "Eochaid's Dancing Blade. Spinning projectile blade. Each enemy kill +10% attack (stacks 5x).",
                tags: ["arcane", "stacking"],
                chars: ["executor", "revenant"]
            },
            {
                name: "Ordovis's Greatsword",
                type: "Greatsword",
                rarity: "legendary",
                req: "Level 10",
                damage: 345,
                scaling: { str: "B", dex: "D", int: "-", fai: "A", arc: "-" },
                effects: "Ordovis's Vortex. Holy tornado that hits 8 times. Each hit increases next hit damage by 15%.",
                tags: ["holy", "faith"],
                chars: ["duchess", "guardian", "raider"]
            },
            {
                name: "Death's Poker",
                type: "Greatsword",
                rarity: "legendary",
                req: "Level 10",
                damage: 325,
                scaling: { str: "C", dex: "C", int: "A", fai: "-", arc: "-" },
                effects: "Ghostflame Ignition. Creates ghostflame explosions. Frost + Magic damage. Ignores 40% magic resistance.",
                tags: ["frost", "magic", "ghostflame"],
                chars: ["revenant", "recluse"]
            },
            {
                name: "Helphen's Steeple",
                type: "Greatsword",
                rarity: "legendary",
                req: "Level 10",
                damage: 330,
                scaling: { str: "C", dex: "D", int: "A", fai: "-", arc: "-" },
                effects: "Ruinous Ghostflame. Summons ghostflame that persists for 10 seconds. Massive frost buildup.",
                tags: ["frost", "magic", "ghostflame"],
                chars: ["revenant", "recluse"]
            },
            {
                name: "Eclipse Shotel",
                type: "Curved Sword",
                rarity: "legendary",
                req: "Level 10",
                damage: 270,
                scaling: { str: "D", dex: "C", int: "-", fai: "B", arc: "-" },
                effects: "Death Flare. Exploding death mist. Reduces enemy max HP by 10%. Bypasses shields.",
                tags: ["holy", "faith", "hp-reduction"],
                chars: ["duchess", "revenant", "executor"]
            },
            {
                name: "Golden Order Greatsword",
                type: "Greatsword",
                rarity: "legendary",
                req: "Level 10",
                damage: 320,
                scaling: { str: "D", dex: "D", int: "B", fai: "A", arc: "-" },
                effects: "Establish Order. Holy explosion that debuffs enemies. Magic resistance -30%. Best vs magic bosses.",
                tags: ["holy", "faith", "intelligence"],
                chars: ["duchess", "recluse"]
            },
            {
                name: "Winged Scythe",
                type: "Reaper",
                rarity: "legendary",
                req: "Level 10",
                damage: 290,
                scaling: { str: "D", dex: "C", int: "-", fai: "A", arc: "-" },
                effects: "Angel's Wings. Leap attack with holy explosion. Prevents enemies from healing for 10 seconds.",
                tags: ["holy", "faith", "anti-heal"],
                chars: ["duchess", "revenant"]
            },
            {
                name: "Dragon Communion Seal",
                type: "Sacred Seal",
                rarity: "legendary",
                req: "Level 10",
                damage: 0,
                scaling: { str: "-", dex: "-", int: "-", fai: "B", arc: "S" },
                effects: "Boosts Dragon Communion incantations by 40%. Arcane/Faith hybrid seal. Best bleed build seal.",
                tags: ["faith", "arcane", "seal"],
                chars: ["executor", "duchess"]
            },
            {
                name: "Lusat's Glintstone Staff",
                type: "Glintstone Staff",
                rarity: "legendary",
                req: "Level 10",
                damage: 0,
                scaling: { str: "-", dex: "-", int: "S", fai: "-", arc: "-" },
                effects: "Boosts all sorceries by 30%. Spells cost +50% FP but hit like trucks. Best pure INT staff.",
                tags: ["magic", "intelligence", "staff"],
                chars: ["recluse"]
            },

            // RARE WEAPONS
            {
                name: "Giant-Crusher",
                type: "Colossal Weapon",
                rarity: "rare",
                req: "Level 7",
                damage: 370,
                scaling: { str: "S", dex: "D", int: "-", fai: "-", arc: "-" },
                effects: "Pure STR scaling perfection. Highest AR in game when two-handed. Pancakes everything.",
                tags: ["strength"],
                chars: ["wylder", "raider", "guardian"]
            },
            {
                name: "Bloodhound's Fang",
                type: "Curved Greatsword",
                rarity: "rare",
                req: "Level 7",
                damage: 305,
                scaling: { str: "C", dex: "A", int: "-", fai: "-", arc: "-" },
                effects: "Bloodhound's Finesse. Quick slash + backstep. Bleed buildup +55. Early game monster.",
                tags: ["bleed", "dex", "mobility"],
                chars: ["executor", "raider"]
            },
            {
                name: "Moonveil",
                type: "Katana",
                rarity: "rare",
                req: "Level 7",
                damage: 285,
                scaling: { str: "E", dex: "B", int: "A", arc: "-" },
                effects: "Transient Moonlight. Fast magic slash projectiles. INT/DEX hybrid classic. Still cracked.",
                tags: ["magic", "dex", "intelligence"],
                chars: ["recluse", "executor"]
            },
            {
                name: "Hand of Malenia",
                type: "Katana",
                rarity: "rare",
                req: "Level 7",
                damage: 295,
                scaling: { str: "E", dex: "S", int: "-", fai: "-", arc: "-" },
                effects: "Waterfowl Dance. The infamous move. Highest DEX scaling. Skill issue detector.",
                tags: ["dex"],
                chars: ["executor", "ironeye"]
            },
            {
                name: "Nagakiba",
                type: "Katana",
                rarity: "rare",
                req: "Level 7",
                damage: 280,
                scaling: { str: "D", dex: "A", int: "-", fai: "-", arc: "-" },
                effects: "Longest katana. Any Ash of War. Perfect for custom bleed builds with Seppuku.",
                tags: ["dex", "versatile"],
                chars: ["executor", "ironeye"]
            },
            {
                name: "Uchigatana",
                type: "Katana",
                rarity: "uncommon",
                req: "Level 3",
                damage: 270,
                scaling: { str: "D", dex: "B", int: "-", fai: "-", arc: "-" },
                effects: "Classic starting katana. Can apply any Ash of War. Dual wield potential. Reliable.",
                tags: ["dex", "versatile"],
                chars: ["executor", "ironeye"]
            },
            {
                name: "Greatsword",
                type: "Colossal Sword",
                rarity: "rare",
                req: "Level 7",
                damage: 355,
                scaling: { str: "S", dex: "D", int: "-", fai: "-", arc: "-" },
                effects: "The Guts sword. Ridiculous reach and damage. Can apply Ashes of War. STR build staple.",
                tags: ["strength"],
                chars: ["wylder", "raider", "guardian"]
            },
            {
                name: "Zweihander",
                type: "Colossal Sword",
                rarity: "rare",
                req: "Level 7",
                damage: 345,
                scaling: { str: "A", dex: "C", int: "-", fai: "-", arc: "-" },
                effects: "The Legend. Fast for a colossal. Crouch poke broken. Nostalgia buff +100.",
                tags: ["strength"],
                chars: ["wylder", "raider"]
            },
            {
                name: "Prelate's Inferno Crozier",
                type: "Colossal Weapon",
                rarity: "rare",
                req: "Level 7",
                damage: 365,
                scaling: { str: "S", dex: "-", int: "-", fai: "C", arc: "-" },
                effects: "Giant fire hammer. Charge attack creates lava puddle. Fire damage +35%. Bonk with style.",
                tags: ["fire", "strength", "faith"],
                chars: ["wylder", "duchess"]
            },
            {
                name: "Carian Regal Scepter",
                type: "Glintstone Staff",
                rarity: "rare",
                req: "Level 7",
                damage: 0,
                scaling: { str: "-", dex: "-", int: "A", fai: "-", arc: "-" },
                effects: "Boosts Full Moon sorceries by 25%. Best balanced INT staff. No downsides.",
                tags: ["magic", "intelligence", "staff"],
                chars: ["recluse", "revenant"]
            },
            {
                name: "Meteorite Staff",
                type: "Glintstone Staff",
                rarity: "uncommon",
                req: "Level 3",
                damage: 0,
                scaling: { str: "-", dex: "-", int: "B", fai: "-", arc: "-" },
                effects: "Boosts Gravity sorceries by 30%. Cannot upgrade but S-tier early game.",
                tags: ["magic", "intelligence", "staff"],
                chars: ["recluse"]
            },
            {
                name: "Erdtree Seal",
                type: "Sacred Seal",
                rarity: "rare",
                req: "Level 7",
                damage: 0,
                scaling: { str: "-", dex: "-", int: "-", fai: "A", arc: "-" },
                effects: "Boosts Erdtree incantations by 20%. Best balanced Faith seal. Golden Order buff.",
                tags: ["faith", "holy", "seal"],
                chars: ["duchess", "guardian"]
            },
            {
                name: "Godslayer's Seal",
                type: "Sacred Seal",
                rarity: "rare",
                req: "Level 7",
                damage: 0,
                scaling: { str: "-", dex: "-", int: "-", fai: "A", arc: "-" },
                effects: "Boosts Black Flame incantations by 30%. Best for Godslayer builds.",
                tags: ["faith", "fire", "seal"],
                chars: ["duchess"]
            },
            {
                name: "Golem Greatbow",
                type: "Greatbow",
                rarity: "rare",
                req: "Level 7",
                damage: 320,
                scaling: { str: "A", dex: "C", int: "-", fai: "-", arc: "-" },
                effects: "Massive range. Through Shot skill. Knocks down large enemies. Sniper elite.",
                tags: ["strength", "bow"],
                chars: ["ironeye", "guardian"]
            },
            {
                name: "Lion Greatbow",
                type: "Greatbow",
                rarity: "rare",
                req: "Level 7",
                damage: 310,
                scaling: { str: "B", dex: "B", int: "-", fai: "-", arc: "-" },
                effects: "Radahn's Spears. Rain of gravity arrows. AOE destruction. Boss killer.",
                tags: ["strength", "dex", "bow"],
                chars: ["ironeye", "raider"]
            },
            {
                name: "Pulley Bow",
                type: "Bow",
                rarity: "uncommon",
                req: "Level 3",
                damage: 220,
                scaling: { str: "D", dex: "B", int: "-", fai: "-", arc: "-" },
                effects: "Longest range bow. Multiple shot types. Versatile. Best for applying status effects.",
                tags: ["dex", "bow"],
                chars: ["ironeye"]
            },
            {
                name: "Serpent Bow",
                type: "Bow",
                rarity: "uncommon",
                req: "Level 3",
                damage: 215,
                scaling: { str: "D", dex: "A", int: "-", fai: "-", arc: "B" },
                effects: "Poison buildup +80 on arrows. Arcane scaling for status bows. Poison sniper.",
                tags: ["poison", "arcane", "bow"],
                chars: ["ironeye", "executor"]
            },
            {
                name: "Reduvia",
                type: "Dagger",
                rarity: "uncommon",
                req: "Level 3",
                damage: 240,
                scaling: { str: "D", dex: "C", int: "-", fai: "-", arc: "A" },
                effects: "Reduvia Blood Blade. Projectile blood slashes. Bleed +70. Early arcane weapon.",
                tags: ["bleed", "arcane"],
                chars: ["executor"]
            },
            {
                name: "Black Knife",
                type: "Dagger",
                rarity: "rare",
                req: "Level 7",
                damage: 250,
                scaling: { str: "D", dex: "A", int: "-", fai: "B", arc: "-" },
                effects: "Blade of Death. Reduces enemy max HP by 10%. Invisible on crouch. Assassin's dream.",
                tags: ["holy", "dex", "faith"],
                chars: ["executor", "revenant", "duchess"]
            },
            {
                name: "Hoslow's Petal Whip",
                type: "Whip",
                rarity: "uncommon",
                req: "Level 3",
                damage: 245,
                scaling: { str: "E", dex: "A", int: "-", fai: "-", arc: "-" },
                effects: "Longest range whip. Can dual wield. Bleed buildup +55. Impossible to parry.",
                tags: ["bleed", "dex"],
                chars: ["executor", "duchess"]
            },
            {
                name: "Vyke's War Spear",
                type: "Great Spear",
                rarity: "rare",
                req: "Level 7",
                damage: 305,
                scaling: { str: "C", dex: "C", int: "-", fai: "-", arc: "-" },
                effects: "Frenzyflame Thrust. Madness buildup +110. Madness proc staggers + huge damage.",
                tags: ["madness", "fire"],
                chars: ["raider", "wylder"]
            },
            {
                name: "Rosus' Axe",
                type: "Greataxe",
                rarity: "rare",
                req: "Level 7",
                damage: 340,
                scaling: { str: "B", dex: "C", int: "-", fai: "-", arc: "-" },
                effects: "Rosus's Summons. Call spirits to attack. Death buildup. Unique ghostflame axe.",
                tags: ["death", "strength"],
                chars: ["revenant", "wylder", "raider"]
            }
        ];

        // Current filters
        var currentRarityFilter = 'all';
        var currentTypeFilter = 'all';
        var currentSearchTerm = '';

        // ============================================
        // TAB SWITCHING
        // ============================================
        function switchTab(tabName) {
            // Update tab buttons
            var tabButtons = document.querySelectorAll('.tab-btn');
            for (var i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            event.target.classList.add('active');

            // Update tab content
            var statsTab = document.getElementById('statsTab');
            var weaponsTab = document.getElementById('weaponsTab');

            if (tabName === 'stats') {
                statsTab.classList.add('active');
                weaponsTab.classList.remove('active');
            } else if (tabName === 'weapons') {
                statsTab.classList.remove('active');
                weaponsTab.classList.add('active');
                
                // Initialize weapons display
                displayWeapons();
                displayRecommendedWeapons();
                populateWeaponSelect();
                syncCalcLevel();
            }
        }

        // Mobile Tab Switching (for dropdown)
        function switchTabMobile(tabName) {
            // Hide all tabs
            var allTabs = document.querySelectorAll('.tab-content');
            for (var i = 0; i < allTabs.length; i++) {
                allTabs[i].classList.remove('active');
            }

            // Show selected tab
            var tabMap = {
                'stats': 'statsTab',
                'weapons': 'weaponsTab',
                'bosses': 'bossesTab',
                'team': 'teamTab',
                'advdamage': 'advDamageTab',
                'archetypes': 'archetypesTab',
                'relics': 'relicsTab',
                'compare': 'compareTab'
            };

            var targetTab = document.getElementById(tabMap[tabName]);
            if (targetTab) {
                targetTab.classList.add('active');
            }

            // Initialize content if needed
            if (tabName === 'weapons') {
                displayWeapons();
                displayRecommendedWeapons();
                populateWeaponSelect();
                syncCalcLevel();
            } else if (tabName === 'bosses') {
                displayBosses();
            } else if (tabName === 'team') {
                updateTeamAnalysis();
            } else if (tabName === 'archetypes') {
                displayBuilds();
            } else if (tabName === 'relics') {
                displayRelics();
            } else if (tabName === 'compare') {
                updateComparison();
            }
        }

        // ============================================
        // WEAPON FILTERING
        // ============================================
        function filterByRarity(rarity) {
            currentRarityFilter = rarity;
            
            // Update active button
            var buttons = document.querySelectorAll('.filter-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            event.target.classList.add('active');
            
            displayWeapons();
        }

        function filterByType(type) {
            currentTypeFilter = type;
            
            // Update active button
            var buttons = event.target.parentElement.querySelectorAll('.filter-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            event.target.classList.add('active');
            
            displayWeapons();
        }

        function filterWeapons() {
            currentSearchTerm = document.getElementById('weaponSearch').value.toLowerCase();
            displayWeapons();
        }

        function getFilteredWeapons() {
            var filtered = weapons.filter(function(weapon) {
                // Rarity filter
                if (currentRarityFilter !== 'all' && weapon.rarity !== currentRarityFilter) {
                    return false;
                }
                
                // Type filter
                if (currentTypeFilter !== 'all') {
                    var weaponType = weapon.type.toLowerCase();
                    if (weaponType.indexOf(currentTypeFilter.toLowerCase()) === -1) {
                        return false;
                    }
                }
                
                // Search filter
                if (currentSearchTerm) {
                    var searchable = (weapon.name + ' ' + weapon.type + ' ' + weapon.effects).toLowerCase();
                    if (searchable.indexOf(currentSearchTerm) === -1) {
                        return false;
                    }
                }
                
                return true;
            });
            
            return filtered;
        }

        // ============================================
        // DISPLAY WEAPONS
        // ============================================
        function displayWeapons() {
            var filteredWeapons = getFilteredWeapons();
            var html = '';
            
            for (var i = 0; i < filteredWeapons.length; i++) {
                var w = filteredWeapons[i];
                html += createWeaponHTML(w);
            }
            
            document.getElementById('weaponList').innerHTML = html || '<p style="text-align:center;color:var(--text-dim);padding:40px;">No weapons found matching your filters.</p>';
            document.getElementById('weaponCount').textContent = filteredWeapons.length;
        }

        function createWeaponHTML(weapon) {
            var scalingHTML = '';
            var attrs = ['str', 'dex', 'int', 'fai', 'arc'];
            var attrNames = { str: 'STR', dex: 'DEX', int: 'INT', fai: 'FAI', arc: 'ARC' };
            
            for (var j = 0; j < attrs.length; j++) {
                var attr = attrs[j];
                var grade = weapon.scaling[attr];
                if (grade && grade !== '-') {
                    scalingHTML += '<span class="scaling-badge badge-' + grade + '">' + attrNames[attr] + ': ' + grade + '</span>';
                }
            }
            
            return '<div class="weapon-item ' + weapon.rarity + '">' +
                '<div class="weapon-header">' +
                    '<div>' +
                        '<div class="weapon-name">' + weapon.name + '</div>' +
                        '<div class="weapon-type">' + weapon.type + '</div>' +
                    '</div>' +
                    '<div class="weapon-rarity ' + weapon.rarity + '">' + weapon.rarity.toUpperCase() + '</div>' +
                '</div>' +
                '<div class="weapon-req">' + weapon.req + '</div>' +
                (weapon.damage > 0 ? '<div class="weapon-damage"> Base Damage: ' + weapon.damage + '</div>' : '') +
                '<div class="weapon-scaling">' + scalingHTML + '</div>' +
                '<div class="weapon-effects">' + weapon.effects + '</div>' +
            '</div>';
        }

        // ============================================
        // RECOMMENDED WEAPONS
        // ============================================
        function displayRecommendedWeapons() {
            var char = characters[currentCharacter];
            var charName = char.name;
            
            document.getElementById('recCharName').textContent = charName;
            
            var recommended = weapons.filter(function(w) {
                return w.chars && w.chars.indexOf(currentCharacter) !== -1;
            });
            
            var html = '';
            for (var i = 0; i < recommended.length; i++) {
                var w = recommended[i];
                var synergy = getWeaponSynergy(w, char);
                html += createWeaponHTML(w);
                if (synergy) {
                    html = html.replace('</div></div>', '</div>' + synergy + '</div>');
                }
            }
            
            document.getElementById('recommendedWeapons').innerHTML = html || '<p style="text-align:center;color:var(--text-dim);padding:40px;">No specific recommendations for this character.</p>';
        }

        function getWeaponSynergy(weapon, char) {
            var notes = [];
            
            // Check scaling synergy
            var bestScaling = null;
            var bestGrade = '';
            
            for (var attr in weapon.scaling) {
                var grade = weapon.scaling[attr];
                if (grade && grade !== '-') {
                    var charGrade = char.stats[attr === 'str' ? 'strength' : attr === 'dex' ? 'dexterity' : attr === 'int' ? 'intelligence' : attr === 'fai' ? 'faith' : attr === 'arc' ? 'arcane' : ''];
                    
                    if (charGrade === 'S' || charGrade === 'A') {
                        if (grade === 'S' || grade === 'A' || grade === 'B') {
                            notes.push('Perfect scaling synergy with your ' + (attr === 'str' ? 'Strength' : attr === 'dex' ? 'Dexterity' : attr === 'int' ? 'Intelligence' : attr === 'fai' ? 'Faith' : 'Arcane'));
                        }
                    }
                }
            }
            
            if (notes.length > 0) {
                return '<div class="rec-weapon-note"> ' + notes[0] + '</div>';
            }
            
            return '';
        }

        // ============================================
        // DAMAGE CALCULATOR
        // ============================================
        function populateWeaponSelect() {
            var select = document.getElementById('calcWeapon');
            var html = '<option value="">Choose a weapon...</option>';
            
            for (var i = 0; i < weapons.length; i++) {
                var w = weapons[i];
                if (w.damage > 0) {
                    html += '<option value="' + i + '">' + w.name + ' (' + w.damage + ' DMG)</option>';
                }
            }
            
            select.innerHTML = html;
        }

        function syncCalcLevel() {
            document.getElementById('calcLevel').value = currentLevel;
        }

        function updateDamageCalc() {
            var weaponIndex = document.getElementById('calcWeapon').value;
            
            if (!weaponIndex) {
                document.getElementById('damagePerHit').textContent = '0';
                document.getElementById('dpsValue').textContent = '0';
                return;
            }
            
            var weapon = weapons[parseInt(weaponIndex)];
            var char = characters[currentCharacter];
            var buffMult = parseFloat(document.getElementById('buffMultiplier').value);
            var attackSpeed = parseFloat(document.getElementById('attackSpeed').value);
            
            // Calculate stat bonuses
            var totalBonus = 0;
            
            for (var attr in weapon.scaling) {
                var grade = weapon.scaling[attr];
                if (grade && grade !== '-') {
                    var charAttr = attr === 'str' ? 'strength' : attr === 'dex' ? 'dexterity' : attr === 'int' ? 'intelligence' : attr === 'fai' ? 'faith' : attr === 'arc' ? 'arcane' : '';
                    if (charAttr) {
                        var charGrade = char.stats[charAttr];
                        var statValue = calculateAttribute(charGrade);
                        var weaponScaling = scalingMultipliers[grade] || 0;
                        totalBonus += statValue * weaponScaling * 0.5; // Scaling contribution
                    }
                }
            }
            
            var baseDamage = weapon.damage;
            var scaledDamage = baseDamage + totalBonus;
            var finalDamage = Math.round(scaledDamage * buffMult);
            var dps = Math.round(finalDamage * attackSpeed);
            
            document.getElementById('damagePerHit').textContent = finalDamage.toLocaleString();
            document.getElementById('dpsValue').textContent = dps.toLocaleString();
        }

        
        // ============================================
        // BOSS DATABASE - 8 NIGHTLORDS + MAJOR BOSSES
        // ============================================
        var bosses = [
            // NIGHTLORDS
            {
                name: "Caligo, Miasma of Night",
                type: "Nightlord - Frost Dragon",
                difficulty: "nightlord",
                weaknesses: ["fire", "bleed"],
                resistances: ["frost", "magic"],
                strategy: {
                    overview: "Frost dragon with devastating breath attacks and wing slams. Extremely vulnerable to fire and hemorrhage.",
                    phase1: "Stay close to rear legs. Punish breath attacks. Fire weapons melt through his frost resistance. Stack bleed procs to repeatedly stagger him.",
                    phase2: "Becomes airborne. Use ranged attacks or wait for landing. Massive frost AOE requires quick dodging. Team coordination essential.",
                    tips: "Executor with Rivers of Blood absolutely demolishes this fight. Duchess can cleanse frost buildup. Guardian tanks breath attacks."
                },
                bestChars: ["Executor", "Wylder", "Duchess"],
                recommendedWeapons: ["Blasphemous Blade", "Rivers of Blood", "Eleonora's Poleblade"],
                expedition: 1
            },
            {
                name: "Libra, Creature of Night",
                type: "Nightlord - Madness Scales",
                difficulty: "nightlord",
                weaknesses: ["fire", "holy"],
                resistances: ["madness", "poison"],
                strategy: {
                    overview: "Teleporting entity that inflicts madness. Stay out of golden circles. Interrupt meditation stance or fight becomes nearly impossible.",
                    phase1: "Golden circle = instant madness buildup. Avoid at all costs. Interrupt meditation with ranged attacks or aggressive melee.",
                    phase2: "Meditation completes = madness ramps up, AOE explosions every 3 seconds. If this happens, retreat and regroup.",
                    tips: "Fire and Holy damage interrupt meditation. Ironeye can safely interrupt from range. Duchess cleanses madness. DO NOT let meditation finish."
                },
                bestChars: ["Ironeye", "Duchess", "Executor"],
                recommendedWeapons: ["Blasphemous Blade", "Godslayer's Greatsword", "Sacred Relic Sword"],
                expedition: 2
            },
            {
                name: "Fulghor, Darkdrift Knight",
                type: "Nightlord - Lightning Cavalry",
                difficulty: "nightlord",
                weaknesses: ["lightning"],
                resistances: ["holy", "physical"],
                strategy: {
                    overview: "Mounted knight with extreme mobility. ONLY weak to lightning. Most difficult Nightlord due to single weakness.",
                    phase1: "Constant charges and leaps. Lightning procs cause brief stagger and explosion. Time lightning attacks to interrupt charges.",
                    phase2: "Empowerment attempts - interrupt with lightning or suffer +50% damage buff. More aggressive, faster attacks.",
                    tips: "Lightning is ESSENTIAL. Bolt of Gransax, Dragon King's Cragblade, or lightning incantations. Ironeye with lightning arrows dominates. This is a DPS check."
                },
                bestChars: ["Ironeye", "Executor", "Duchess"],
                recommendedWeapons: ["Bolt of Gransax", "Dragon King's Cragblade", "Vyke's War Spear"],
                expedition: 3
            },
            {
                name: "Heolstor, Fell Devourer",
                type: "Nightlord - Death Incarnate",
                difficulty: "nightlord",
                weaknesses: ["holy", "fire"],
                resistances: ["death", "poison"],
                strategy: {
                    overview: "Two-phase nightmare. Phase 1 tests mechanics. Phase 2 is pure survival. Save resources for phase 2.",
                    phase1: "Learn combos. Don't waste heals. Bait attacks, punish recovery. Slow and methodical. Practice dodge timings.",
                    phase2: "All attacks deal 50% more damage. Death fog inflicts constant damage. Stay mobile. Burst damage windows are shorter. Ultimate Arts recommended.",
                    tips: "Balanced team essential: Raider buffs, Guardian tanks, Ironeye revives. Holy damage melts phase 2. Don't use healing flasks in phase 1 unless emergency."
                },
                bestChars: ["Raider", "Guardian", "Ironeye"],
                recommendedWeapons: ["Maliketh's Black Blade", "Sacred Relic Sword", "Inseparable Sword"],
                expedition: 4
            },
            {
                name: "Augur, Eyeless Watcher",
                type: "Nightlord - Sleep Horror",
                difficulty: "nightlord",
                weaknesses: ["lightning"],
                resistances: ["sleep", "magic"],
                strategy: {
                    overview: "Floating entity with sleep mechanics. Ranged damage ESSENTIAL. Stack sleep resistance or get one-shot during knockout.",
                    phase1: "Destroy sleep bombs before they explode. Ranged attacks mandatory. Melee gets punished by AOE sleep clouds.",
                    phase2: "Protective bubble - immune until destroyed. Focus fire on bubble. Sleep channel attack - interrupt or entire team sleeps.",
                    tips: "Ironeye is MVP. Sleep resistance relic mandatory. Lightning staggers and destroys bubble faster. Revenant summons distract during bubble phase."
                },
                bestChars: ["Ironeye", "Recluse", "Revenant"],
                recommendedWeapons: ["Lion Greatbow", "Golem Greatbow", "Bolt of Gransax"],
                expedition: 5
            },
            {
                name: "Adel, Gaping Jaw",
                type: "Nightlord - Poison Wyrm",
                difficulty: "nightlord",
                weaknesses: ["poison"],
                resistances: ["physical"],
                strategy: {
                    overview: "Massive worm with grab attacks. Poison is KEY - triggers 8-second vomit animation that interrupts everything.",
                    phase1: "Bait grab attack, poison during recovery. Each poison proc = free 8 seconds of DPS. Avoid ground burrow attacks.",
                    phase2: "Permanent poison clouds everywhere. Wear poison resistance. Continue poison procs to lock it in vomit loop.",
                    tips: "Poison weapons/arrows trivialize this fight. Serpent Bow with poison arrows. Don't revive near boss - draw aggro away first. Poison = win button."
                },
                bestChars: ["Ironeye", "Executor", "Recluse"],
                recommendedWeapons: ["Serpent Bow", "Poison-infused weapons", "Rotten Crystal Staff"],
                expedition: 6
            },
            {
                name: "Night Aspect (Nightlord)",
                type: "Nightlord - Spectral Incarnation",
                difficulty: "nightlord",
                weaknesses: ["fire", "lightning", "holy"],
                resistances: ["magic", "frost"],
                strategy: {
                    overview: "Weak to physical and all elements except magic/frost. Two phases with distinct movesets.",
                    phase1: "Standard melee boss. Dodge combos, punish recovery. Relatively straightforward. Save resources.",
                    phase2: "Spectral form with teleports. Fire/Lightning/Holy deal massive damage. Tracking attacks - dodge late. Ultimate Arts shred this phase.",
                    tips: "Most versatile Nightlord - many builds work. Faith builds dominate. Blasphemous Blade weapon art deletes phase 2. Easy with proper element."
                },
                bestChars: ["Duchess", "Wylder", "Executor"],
                recommendedWeapons: ["Blasphemous Blade", "Maliketh's Black Blade", "Godslayer's Greatsword"],
                expedition: 7
            },
            {
                name: "The Sentient Pest",
                type: "Nightlord - Moth Swarm",
                difficulty: "nightlord",
                weaknesses: ["fire", "lightning"],
                resistances: ["poison", "sleep"],
                strategy: {
                    overview: "Fragile moth with swarm mechanics. Low HP but dangerous AOE. Fire and lightning wreck swarms.",
                    phase1: "Kill adds first. Moths explode on death. Fire AOE weapons clear swarms instantly. Focus main boss when adds down.",
                    phase2: "Massive swarm summon. Fire tornado/AOE essential. Lightning chains through swarms. Ignore adds at your peril.",
                    tips: "Godslayer's Greatsword (Black Flame Tornado) is MVP. Prelate's Inferno Crozier creates lava. AOE > single target. Easiest Nightlord with right build."
                },
                bestChars: ["Wylder", "Duchess", "Recluse"],
                recommendedWeapons: ["Godslayer's Greatsword", "Blasphemous Blade", "Prelate's Inferno Crozier"],
                expedition: 8
            },

            // MAJOR WORLD BOSSES
            {
                name: "Ancient Dragon",
                type: "Evergaol Boss",
                difficulty: "hard",
                weaknesses: ["lightning", "frost"],
                resistances: ["fire", "magic"],
                strategy: {
                    overview: "Deadly dragon in confined space. Lightning weakness is major. Frost slows him down.",
                    phase1: "Stay under belly. Punish breath attacks. Lightning procs stagger. Roll into fire breath, not away.",
                    phase2: "N/A - single phase",
                    tips: "Lightning essential. Bolt of Gransax melts. Guardian can tank breath. Legendary weapon drop rate high."
                },
                bestChars: ["Ironeye", "Guardian", "Executor"],
                recommendedWeapons: ["Bolt of Gransax", "Dragon King's Cragblade", "Dark Moon Greatsword"],
                expedition: "Any"
            },
            {
                name: "Godskin Duo",
                type: "Evergaol Boss",
                difficulty: "hard",
                weaknesses: ["bleed", "frost"],
                resistances: ["holy", "fire"],
                strategy: {
                    overview: "Two bosses simultaneously. Sleep one, kill other. Bleed shreds their massive HP pools.",
                    phase1: "Focus Noble first (slower). Sleep Apostle. Bleed builds dominate. Kite around pillars.",
                    phase2: "They respawn when one dies. Kill both within 10 seconds or repeat. Coordinate burst damage.",
                    tips: "Rivers of Blood duo trivializes. Sleep pots mandatory. Guardian draws aggro. Hardest Evergaol without bleed."
                },
                bestChars: ["Executor", "Raider", "Guardian"],
                recommendedWeapons: ["Rivers of Blood", "Eleonora's Poleblade", "Mohgwyn's Sacred Spear"],
                expedition: "Any"
            },
            {
                name: "Death Rite Bird",
                type: "Evergaol Boss",
                difficulty: "hard",
                weaknesses: ["holy"],
                resistances: ["fire", "death"],
                strategy: {
                    overview: "Spectral bird with death magic. Holy damage essential. Deathblight is instant kill.",
                    phase1: "Avoid ground explosions. Holy weapons 2x damage. Stay mobile. Ranged attacks safe.",
                    phase2: "N/A - single phase",
                    tips: "Sacred Relic Sword weapon art deletes. Duchess hard counters. Avoid deathblight circles at all costs."
                },
                bestChars: ["Duchess", "Ironeye", "Revenant"],
                recommendedWeapons: ["Sacred Relic Sword", "Inseparable Sword", "Maliketh's Black Blade"],
                expedition: "Any"
            },
            {
                name: "Nox Dragonkin",
                type: "Field Boss",
                difficulty: "medium",
                weaknesses: ["lightning", "fire"],
                resistances: ["magic"],
                strategy: {
                    overview: "Dragon-human hybrid. Fast attacks. Lightning weakness exploitable.",
                    phase1: "Dodge tail swipes. Lightning procs stagger. Stay close to avoid breath.",
                    phase2: "N/A - single phase",
                    tips: "Medium difficulty. Good for legendary weapon farming. Lightning makes it trivial."
                },
                bestChars: ["Executor", "Ironeye", "Wylder"],
                recommendedWeapons: ["Bolt of Gransax", "Vyke's War Spear", "Blasphemous Blade"],
                expedition: "Any"
            },
            {
                name: "Balancers (Weapon-Bequeathed Harmonia)",
                type: "Nightlord - 7 Valkyries",
                difficulty: "nightlord",
                weaknesses: ["sleep"],
                resistances: ["physical"],
                strategy: {
                    overview: "7 Valkyries mob boss. Sleep weakness exploitable. Scholar's Communion trivializes fight.",
                    phase1: "7 Valkyries with individual HP. Target one at a time. Split team to spread them. Sleep builds up VERY fast - critical hit sleeping targets.",
                    phase2: "All revive, one becomes Pink Balancer (stronger, pink wings). Kill Pink first = all others stagger briefly. Synchronized AOE when Pink flies up. Focus Pink, then mop up others.",
                    tips: "Scholar Communion links all 7 - damage one damages all = EASY. Sleep weapons MVP. Dragoncrest Shield for physical negation. Level 12+ recommended. Guardian can block ALL attacks with base shield."
                },
                bestChars: ["Scholar", "Ironeye", "Undertaker"],
                recommendedWeapons: ["Sleep-affinity weapons", "Hoarfrost Stomp", "AOE Ashes of War"],
                expedition: 9,
                dlc: true
            },
            {
                name: "Dreglord",
                type: "Nightlord - Scarlet Rot Horror",
                difficulty: "nightlord",
                weaknesses: ["physical"],
                resistances: ["rot", "elemental"],
                strategy: {
                    overview: "Final DLC boss. Raw physical damage only. Phase 2 = constant Scarlet Rot. Preserving Boluses MANDATORY.",
                    phase1: "Standard Nightlord patterns. Save resources. Learn attack timings. Heavy weapons outperform elemental.",
                    phase2: "ALL attacks inflict Scarlet Rot. Constant buildup. Higher damage + more aggressive. Stock 10+ Preserving Boluses minimum. Flask with rot cure tear essential.",
                    tips: "Scholar Communion can link Dreglord to expedition trash mobs for shared damage. Scarlet Rot is the REAL boss. Level 16-18 recommended. Will of the Balancers relic highly recommended. Greatswords/Colossal weapons only."
                },
                bestChars: ["Scholar", "Wylder", "Raider"],
                recommendedWeapons: ["Greatsword", "Giant-Crusher", "Axe of Godfrey"],
                expedition: 10,
                dlc: true
            }
        ];

        // Current boss filters
        var currentBossDifficulty = 'all';
        var currentBossWeak = 'all';
        var currentBossSearch = '';

        // ============================================
        // BOSS TAB SWITCHING
        // ============================================
        function switchTab(tabName) {
            var tabButtons = document.querySelectorAll('.tab-btn');
            for (var i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            event.target.classList.add('active');

            var statsTab = document.getElementById('statsTab');
            var weaponsTab = document.getElementById('weaponsTab');
            var bossesTab = document.getElementById('bossesTab');

            statsTab.classList.remove('active');
            weaponsTab.classList.remove('active');
            bossesTab.classList.remove('active');

            if (tabName === 'stats') {
                statsTab.classList.add('active');
            } else if (tabName === 'weapons') {
                weaponsTab.classList.add('active');
                displayWeapons();
                displayRecommendedWeapons();
                populateWeaponSelect();
                syncCalcLevel();
            } else if (tabName === 'bosses') {
                bossesTab.classList.add('active');
                displayBosses();
                populateBossSelect();
            }
        }

        // ============================================
        // BOSS FILTERING
        // ============================================
        function filterBossDifficulty(difficulty) {
            currentBossDifficulty = difficulty;
            
            var buttons = event.target.parentElement.querySelectorAll('.filter-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            event.target.classList.add('active');
            
            displayBosses();
        }

        function filterBossWeak(weakness) {
            currentBossWeak = weakness;
            
            var buttons = event.target.parentElement.querySelectorAll('.filter-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            event.target.classList.add('active');
            
            displayBosses();
        }

        function filterBosses() {
            currentBossSearch = document.getElementById('bossSearch').value.toLowerCase();
            displayBosses();
        }

        function getFilteredBosses() {
            var filtered = bosses.filter(function(boss) {
                if (currentBossDifficulty !== 'all' && boss.difficulty !== currentBossDifficulty) {
                    return false;
                }
                
                if (currentBossWeak !== 'all') {
                    var hasWeakness = false;
                    for (var i = 0; i < boss.weaknesses.length; i++) {
                        if (boss.weaknesses[i] === currentBossWeak) {
                            hasWeakness = true;
                            break;
                        }
                    }
                    if (!hasWeakness) return false;
                }
                
                if (currentBossSearch) {
                    var searchable = (boss.name + ' ' + boss.type).toLowerCase();
                    if (searchable.indexOf(currentBossSearch) === -1) {
                        return false;
                    }
                }
                
                return true;
            });
            
            return filtered;
        }

        // ============================================
        // DISPLAY BOSSES
        // ============================================
        function displayBosses() {
            var filtered = getFilteredBosses();
            var html = '';
            
            for (var i = 0; i < filtered.length; i++) {
                html += createBossHTML(filtered[i]);
            }
            
            document.getElementById('bossGrid').innerHTML = html || '<p style="text-align:center;color:var(--text-dim);padding:40px;">No bosses found matching your filters.</p>';
            document.getElementById('bossCount').textContent = filtered.length;
        }

        function createBossHTML(boss) {
            var weakHTML = '';
            var weakEmoji = {
                fire: '', lightning: '', holy: '', magic: '',
                poison: '', bleed: '', frost: '', sleep: ''
            };
            
            for (var i = 0; i < boss.weaknesses.length; i++) {
                var weak = boss.weaknesses[i];
                weakHTML += '<span class="weakness-tag ' + weak + '">' + weakEmoji[weak] + ' ' + weak.toUpperCase() + '</span>';
            }
            
            var resHTML = '';
            for (var i = 0; i < boss.resistances.length; i++) {
                resHTML += '<span class="resistance-tag">' + boss.resistances[i].toUpperCase() + '</span>';
            }
            
            var charHTML = '';
            for (var i = 0; i < boss.bestChars.length; i++) {
                charHTML += '<span class="char-tag">' + boss.bestChars[i] + '</span>';
            }
            
            return '<div class="boss-item ' + boss.difficulty + '">' +
                '<div class="boss-header">' +
                    '<div>' +
                        '<div class="boss-name">' + boss.name + '</div>' +
                        '<div class="boss-type">' + boss.type + '</div>' +
                    '</div>' +
                    '<div class="boss-difficulty ' + boss.difficulty + '">' + boss.difficulty.toUpperCase() + '</div>' +
                '</div>' +
                '<div class="weakness-section">' +
                    '<div class="weakness-label"> Weaknesses</div>' +
                    '<div class="weakness-tags">' + weakHTML + '</div>' +
                '</div>' +
                '<div class="weakness-section">' +
                    '<div class="weakness-label"> Resistances</div>' +
                    '<div class="resistance-tags">' + resHTML + '</div>' +
                '</div>' +
                '<div class="boss-strategy">' +
                    '<div class="strategy-section">' +
                        '<div class="strategy-title">Overview</div>' +
                        '<div class="strategy-text">' + boss.strategy.overview + '</div>' +
                    '</div>' +
                    '<div class="strategy-section">' +
                        '<div class="strategy-title">Phase 1 Strategy</div>' +
                        '<div class="strategy-text">' + boss.strategy.phase1 + '</div>' +
                    '</div>' +
                    (boss.strategy.phase2 !== 'N/A' ? 
                        '<div class="strategy-section">' +
                            '<div class="strategy-title">Phase 2 Strategy</div>' +
                            '<div class="strategy-text">' + boss.strategy.phase2 + '</div>' +
                        '</div>' : '') +
                    '<div class="strategy-section">' +
                        '<div class="strategy-title"> Pro Tips</div>' +
                        '<div class="strategy-text">' + boss.strategy.tips + '</div>' +
                    '</div>' +
                    '<div class="strategy-section">' +
                        '<div class="strategy-title"> Best Characters</div>' +
                        '<div class="best-chars">' + charHTML + '</div>' +
                    '</div>' +
                '</div>' +
            '</div>';
        }

        // ============================================
        // BOSS COUNTER BUILDER
        // ============================================
        function populateBossSelect() {
            var select = document.getElementById('counterBoss');
            var html = '<option value="">Choose a boss...</option>';
            
            for (var i = 0; i < bosses.length; i++) {
                html += '<option value="' + i + '">' + bosses[i].name + '</option>';
            }
            
            select.innerHTML = html;
        }

        function updateCounterBuild() {
            var bossIndex = document.getElementById('counterBoss').value;
            
            if (!bossIndex) {
                document.getElementById('counterDisplay').innerHTML = '<p style="text-align:center;color:var(--text-dim);padding:40px;">Select a boss to see recommended counter build.</p>';
                return;
            }
            
            var boss = bosses[parseInt(bossIndex)];
            var char = characters[currentCharacter];
            
            // Find weapons that exploit weaknesses
            var counterWeapons = [];
            for (var i = 0; i < weapons.length; i++) {
                var weapon = weapons[i];
                for (var j = 0; j < boss.weaknesses.length; j++) {
                    var weak = boss.weaknesses[j];
                    if (weapon.tags && weapon.tags.indexOf(weak) !== -1) {
                        counterWeapons.push(weapon);
                        break;
                    }
                }
            }
            
            // Sort by rarity
            counterWeapons.sort(function(a, b) {
                var rarityOrder = { legendary: 0, rare: 1, uncommon: 2 };
                return rarityOrder[a.rarity] - rarityOrder[b.rarity];
            });
            
            var html = '<div class="counter-section">' +
                '<div class="counter-section-title"> Counter Strategy for ' + boss.name + '</div>';
            
            // Weaknesses
            html += '<div class="counter-item"><strong>Exploit These Weaknesses:</strong> ';
            for (var i = 0; i < boss.weaknesses.length; i++) {
                html += boss.weaknesses[i].toUpperCase();
                if (i < boss.weaknesses.length - 1) html += ', ';
            }
            html += '</div>';
            
            // Best characters
            html += '<div class="counter-item"><strong>Optimal Characters:</strong> ';
            for (var i = 0; i < boss.bestChars.length; i++) {
                html += boss.bestChars[i];
                if (i < boss.bestChars.length - 1) html += ', ';
            }
            html += '</div>';
            
            html += '</div>';
            
            // Recommended weapons
            if (counterWeapons.length > 0) {
                html += '<div class="counter-section">' +
                    '<div class="counter-section-title"> Recommended Weapons</div>';
                
                var displayCount = Math.min(5, counterWeapons.length);
                for (var i = 0; i < displayCount; i++) {
                    var w = counterWeapons[i];
                    html += '<div class="counter-item">' +
                        '<span class="counter-weapon">' + w.name + '</span> (' + w.type + ') - ' +
                        w.effects +
                    '</div>';
                }
                
                html += '</div>';
            }
            
            // Strategy tips
            html += '<div class="counter-section">' +
                '<div class="counter-section-title"> Strategy Tips</div>' +
                '<div class="counter-item">' + boss.strategy.tips + '</div>' +
            '</div>';
            
            document.getElementById('counterDisplay').innerHTML = html;
        }

        
        // ============================================
        // TEAM BUILDER SYSTEM
        // ============================================
        var characterRoles = {
            wylder: { primary: 'DPS', secondary: 'Tank' },
            guardian: { primary: 'Tank', secondary: 'Support' },
            ironeye: { primary: 'Support', secondary: 'DPS' },
            raider: { primary: 'DPS', secondary: 'Support' },
            recluse: { primary: 'DPS', secondary: 'Hybrid' },
            executor: { primary: 'DPS', secondary: 'Hybrid' },
            duchess: { primary: 'Support', secondary: 'Hybrid' },
            revenant: { primary: 'Hybrid', secondary: 'Support' },
            scholar: { primary: 'Support', secondary: 'Hybrid' },
            undertaker: { primary: 'DPS', secondary: 'Hybrid' }
        };

        var teamSynergies = [
            {
                chars: ['executor', 'raider', 'guardian'],
                name: 'Bleed Devastation',
                desc: 'Executor stacks bleed with Rivers of Blood. Raider buffs team damage with Warlord Totem (+60%). Guardian tanks while Executor melts bosses. Perfect for Caligo and Fulghor.'
            },
            {
                chars: ['recluse', 'duchess', 'ironeye'],
                name: 'Magic Artillery',
                desc: 'Recluse nukes with Comet Azur. Duchess heals and buffs. Ironeye revives from range and provides ranged DPS. Best for bosses weak to magic/holy.'
            },
            {
                chars: ['wylder', 'raider', 'duchess'],
                name: 'Strength Squad',
                desc: 'Double STR scaling with Raider buffs. Duchess keeps team alive. Grafted Blade + Warlord Totem = unstoppable. Staggers everything.'
            },
            {
                chars: ['ironeye', 'executor', 'duchess'],
                name: 'Safe Carry',
                desc: 'Ironeye keeps distance, revives safely. Duchess heals and cleanses. Executor maximizes DPS. Safest team comp for learning new bosses.'
            },
            {
                chars: ['revenant', 'duchess', 'guardian'],
                name: 'Summoner Army',
                desc: 'Revenant summons last 100% longer. Duchess heals summons. Guardian tanks. Bosses fight an army. Great for solo practice with AI.'
            },
            {
                chars: ['recluse', 'executor', 'raider'],
                name: 'Glass Cannon',
                desc: 'Maximum DPS, minimal defense. Raider buffs, Executor bleeds, Recluse nukes. Kill boss before it kills you. High risk, high reward.'
            },
            {
                chars: ['scholar', 'executor', 'ironeye'],
                name: 'Scholar Support Squad',
                desc: 'Scholar applies debuffs + status effects. Executor bleeds. Ironeye ranged DPS + revives. Communion shares damage across all enemies. Perfect for DLC bosses.'
            },
            {
                chars: ['undertaker', 'duchess', 'raider'],
                name: 'Undertaker Ult-Spam',
                desc: 'GAME-BREAKING: Duchess ults  Undertaker free ult via Confluence  Duchess Restage doubles damage  Raider buffs stack. Infinite ult loop. Balancers die in 60 seconds.'
            },
            {
                chars: ['scholar', 'undertaker', 'raider'],
                name: 'DLC Dream Team',
                desc: 'Scholar Communion links enemies. Undertaker ult-spams. Raider Warlord Totem buffs. Scholar debuffs stack with Raider buffs. META for all DLC content.'
            }
        ];

        var presetTeams = [
            {
                name: 'Meta Comp - Ultimate Progression',
                chars: ['Executor', 'Raider', 'Ironeye'],
                desc: 'Most versatile team. Executor DPS, Raider buffs, Ironeye safety. Works on ALL Nightlords. Recommended for first clears.'
            },
            {
                name: 'Tank & Spank',
                chars: ['Guardian', 'Duchess', 'Wylder'],
                desc: 'Immortal team. Guardian tanks, Duchess heals, Wylder bonks. Slow but safe. Perfect for learning mechanics.'
            },
            {
                name: 'Speed Run',
                chars: ['Executor', 'Recluse', 'Raider'],
                desc: 'Maximum burst damage. Kill bosses in under 2 minutes. Requires perfect execution. Veteran teams only.'
            },
            {
                name: 'Bleed Meta',
                chars: ['Executor', 'Executor', 'Raider'],
                desc: 'Double Executor with Rivers of Blood. Raider buffs. Stack bleed procs. Trivializes Caligo, Heolstor, Adel.'
            },
            {
                name: 'DLC Meta - Balancers Destroyer',
                chars: ['Scholar', 'Undertaker', 'Ironeye'],
                desc: 'Scholar Communion links all 7 Valkyries. Undertaker ult-spams. Ironeye AOE. Balancers die in seconds. BROKEN for DLC.'
            },
            {
                name: 'Infinite Ultimates',
                chars: ['Undertaker', 'Duchess', 'Raider'],
                desc: 'Undertaker Confluence passive = free ult when ally ults. Chain with Duchess. Raider buffs. Boss fights become ult spam festivals.'
            }
        ];

        function updateTeamAnalysis() {
            var p1 = document.getElementById('player1').value;
            var p2 = document.getElementById('player2').value;
            var p3 = document.getElementById('player3').value;
            
            var team = [p1, p2, p3];
            
            // Update role badges
            updateRoleBadge('role1', p1);
            updateRoleBadge('role2', p2);
            updateRoleBadge('role3', p3);
            
            // Update character previews
            updateCharPreview('preview1', p1);
            updateCharPreview('preview2', p2);
            updateCharPreview('preview3', p3);
            
            // Calculate team balance
            var roleCount = { DPS: 0, Tank: 0, Support: 0, Hybrid: 0 };
            for (var i = 0; i < team.length; i++) {
                var char = team[i];
                var roles = characterRoles[char];
                roleCount[roles.primary]++;
                if (roles.secondary !== roles.primary) {
                    roleCount[roles.secondary] += 0.5;
                }
            }
            
            // Calculate synergy score
            var synergyScore = 0;
            var activeSynergies = [];
            
            for (var i = 0; i < teamSynergies.length; i++) {
                var syn = teamSynergies[i];
                var matches = 0;
                for (var j = 0; j < syn.chars.length; j++) {
                    if (team.indexOf(syn.chars[j]) !== -1) {
                        matches++;
                    }
                }
                if (matches === 3) {
                    synergyScore += 100;
                    activeSynergies.push(syn);
                } else if (matches === 2) {
                    synergyScore += 30;
                }
            }
            
            // Balance score
            var idealBalance = { DPS: 1.5, Tank: 1, Support: 1, Hybrid: 0.5 };
            var balanceScore = 100;
            for (var role in idealBalance) {
                var diff = Math.abs(roleCount[role] - idealBalance[role]);
                balanceScore -= diff * 15;
            }
            balanceScore = Math.max(0, balanceScore);
            
            // Display analysis
            var totalScore = Math.round((synergyScore + balanceScore) / 2);
            var rating = totalScore >= 80 ? 'EXCELLENT' : totalScore >= 60 ? 'GOOD' : totalScore >= 40 ? 'DECENT' : 'NEEDS WORK';
            
            var analysisHTML = '<div class="analysis-grid">' +
                '<div class="analysis-stat">' +
                    '<div class="analysis-label">Team Rating</div>' +
                    '<div class="analysis-value">' + rating + '</div>' +
                '</div>' +
                '<div class="analysis-stat">' +
                    '<div class="analysis-label">Synergy Score</div>' +
                    '<div class="analysis-value">' + Math.round(synergyScore) + '/100</div>' +
                '</div>' +
                '<div class="analysis-stat">' +
                    '<div class="analysis-label">Balance Score</div>' +
                    '<div class="analysis-value">' + Math.round(balanceScore) + '/100</div>' +
                '</div>' +
            '</div>' +
            '<div class="balance-bars">' +
                '<div class="balance-bar">' +
                    '<div class="balance-label"><span>DPS</span><span>' + roleCount.DPS.toFixed(1) + '</span></div>' +
                    '<div class="balance-track"><div class="balance-fill" style="width:' + (roleCount.DPS / 3 * 100) + '%">' + (roleCount.DPS > 0 ? Math.round(roleCount.DPS / 3 * 100) + '%' : '') + '</div></div>' +
                '</div>' +
                '<div class="balance-bar">' +
                    '<div class="balance-label"><span>Tank</span><span>' + roleCount.Tank.toFixed(1) + '</span></div>' +
                    '<div class="balance-track"><div class="balance-fill" style="width:' + (roleCount.Tank / 3 * 100) + '%">' + (roleCount.Tank > 0 ? Math.round(roleCount.Tank / 3 * 100) + '%' : '') + '</div></div>' +
                '</div>' +
                '<div class="balance-bar">' +
                    '<div class="balance-label"><span>Support</span><span>' + roleCount.Support.toFixed(1) + '</span></div>' +
                    '<div class="balance-track"><div class="balance-fill" style="width:' + (roleCount.Support / 3 * 100) + '%">' + (roleCount.Support > 0 ? Math.round(roleCount.Support / 3 * 100) + '%' : '') + '</div></div>' +
                '</div>' +
            '</div>';
            
            document.getElementById('teamAnalysis').innerHTML = analysisHTML;
            
            // Display active synergies
            var synergyHTML = '';
            if (activeSynergies.length > 0) {
                for (var i = 0; i < activeSynergies.length; i++) {
                    synergyHTML += '<div class="synergy-item"><strong> ' + activeSynergies[i].name + '</strong><br>' + activeSynergies[i].desc + '</div>';
                }
            } else {
                synergyHTML = '<div class="synergy-item">No perfect synergies detected. Try one of the preset teams below!</div>';
            }
            
            document.getElementById('synergyList').innerHTML = synergyHTML;
            
            // Display presets
            displayPresetTeams();
        }

        function updateRoleBadge(badgeId, charId) {
            var badge = document.getElementById(badgeId);
            var role = characterRoles[charId].primary;
            badge.textContent = role.toUpperCase();
            badge.className = 'role-badge ' + role.toLowerCase();
        }

        function updateCharPreview(previewId, charId) {
            var char = characters[charId];
            var role = characterRoles[charId];
            
            var html = '<strong>' + char.name + '</strong> (' + role.primary + '/' + role.secondary + ')<br>' +
                'Ultimate: ' + char.ultimate.substring(0, 60) + '...';
            
            document.getElementById(previewId).innerHTML = html;
        }

        function displayPresetTeams() {
            var html = '';
            for (var i = 0; i < presetTeams.length; i++) {
                var preset = presetTeams[i];
                html += '<div class="preset-team" onclick="loadPreset(' + i + ')">' +
                    '<div class="preset-title">' + preset.name + '</div>' +
                    '<div class="preset-chars"> ' + preset.chars.join(' + ') + '</div>' +
                    '<div class="preset-desc">' + preset.desc + '</div>' +
                '</div>';
            }
            document.getElementById('presetTeams').innerHTML = html;
        }

        function loadPreset(index) {
            var preset = presetTeams[index];
            var charMap = {
                'Wylder': 'wylder', 'Guardian': 'guardian', 'Ironeye': 'ironeye',
                'Raider': 'raider', 'Recluse': 'recluse', 'Executor': 'executor',
                'Duchess': 'duchess', 'Revenant': 'revenant'
            };
            
            document.getElementById('player1').value = charMap[preset.chars[0]];
            document.getElementById('player2').value = charMap[preset.chars[1]];
            document.getElementById('player3').value = charMap[preset.chars[2]];
            
            updateTeamAnalysis();
        }

        // ============================================
        // ADVANCED DAMAGE CALCULATOR
        // ============================================
        function populateAdvWeaponSelect() {
            var select = document.getElementById('advWeapon');
            var html = '<option value="">Choose weapon...</option>';
            
            for (var i = 0; i < weapons.length; i++) {
                var w = weapons[i];
                if (w.damage > 0) {
                    html += '<option value="' + i + '">' + w.name + ' (' + w.damage + ' DMG)</option>';
                }
            }
            
            select.innerHTML = html;
        }

        function updateAdvCalc() {
            // Get weapon info
            var weaponIndex = document.getElementById('advWeapon').value;
            var baseDmg = parseFloat(document.getElementById('advBaseDmg').value) || 0;
            
            if (weaponIndex) {
                var weapon = weapons[parseInt(weaponIndex)];
                document.getElementById('advBaseDmg').value = weapon.damage;
                baseDmg = weapon.damage;
            }
            
            // Get character stats
            var charLevel = parseInt(document.getElementById('advCharLevel').value);
            var scalingStat = document.getElementById('advScalingStat').value;
            var scalingGrade = document.getElementById('advScalingGrade').value;
            
            // Calculate stat value from character
            var char = characters[currentCharacter];
            var statGrade = char.stats[scalingStat];
            var statValue = calculateAttribute(statGrade);
            document.getElementById('advStatValue').value = statValue;
            
            // Get modifiers
            var teamBuff = parseFloat(document.getElementById('advTeamBuff').value);
            var personalBuff = parseFloat(document.getElementById('advPersonalBuff').value);
            var relicBonus = parseFloat(document.getElementById('advRelicBonus').value);
            var counterBuff = parseFloat(document.getElementById('advCounterBuff').value);
            var atkSpeed = parseFloat(document.getElementById('advAtkSpeed').value);
            var critChance = parseFloat(document.getElementById('advCritChance').value) / 100;
            var critMult = parseFloat(document.getElementById('advCritMult').value);
            var bossRes = parseFloat(document.getElementById('advBossRes').value);
            
            // CALCULATION BREAKDOWN
            var breakdown = '';
            
            // Step 1: Base Damage
            var step1 = baseDmg;
            breakdown += '<strong>Step 1: Base Weapon Damage</strong><br>';
            breakdown += baseDmg + '<br><br>';
            
            // Step 2: Scaling Bonus
            var scalingMult = scalingMultipliers[scalingGrade];
            var scalingBonus = statValue * scalingMult * 0.6; // Scaling contribution
            var step2 = step1 + scalingBonus;
            breakdown += '<strong>Step 2: Apply Stat Scaling</strong><br>';
            breakdown += baseDmg + ' + (' + statValue + '  ' + scalingMult + '  0.6) = ' + Math.round(step2) + '<br><br>';
            
            // Step 3: Team Buffs
            var step3 = step2 * teamBuff;
            breakdown += '<strong>Step 3: Team Buff</strong><br>';
            breakdown += Math.round(step2) + '  ' + teamBuff + ' = ' + Math.round(step3) + '<br><br>';
            
            // Step 4: Personal Buffs
            var step4 = step3 * personalBuff;
            breakdown += '<strong>Step 4: Personal Buff</strong><br>';
            breakdown += Math.round(step3) + '  ' + personalBuff + ' = ' + Math.round(step4) + '<br><br>';
            
            // Step 5: Relic Bonus
            var step5 = step4 * relicBonus;
            breakdown += '<strong>Step 5: Relic Bonus</strong><br>';
            breakdown += Math.round(step4) + '  ' + relicBonus + ' = ' + Math.round(step5) + '<br><br>';
            
            // Step 6: Counter/Weakness Bonus
            var step6 = step5 * counterBuff;
            breakdown += '<strong>Step 6: Weakness/Counter Bonus</strong><br>';
            breakdown += Math.round(step5) + '  ' + counterBuff + ' = ' + Math.round(step6) + '<br><br>';
            
            // Step 7: Boss Resistance
            var step7 = step6 * bossRes;
            breakdown += '<strong>Step 7: Boss Resistance</strong><br>';
            breakdown += Math.round(step6) + '  ' + bossRes + ' = ' + Math.round(step7) + '<br><br>';
            
            // Step 8: Average with Crits
            var critBonus = critChance * (critMult - 1);
            var avgMultiplier = 1 + critBonus;
            var step8 = step7 * avgMultiplier;
            breakdown += '<strong>Step 8: Average Damage (with Crits)</strong><br>';
            breakdown += Math.round(step7) + '  ' + avgMultiplier.toFixed(2) + ' = ' + Math.round(step8) + '<br><br>';
            
            // Step 9: DPS
            var dps = step8 * atkSpeed;
            breakdown += '<strong>Step 9: DPS</strong><br>';
            breakdown += Math.round(step8) + '  ' + atkSpeed + ' = ' + Math.round(dps);
            
            // Update display
            document.getElementById('advResultBase').textContent = Math.round(step1).toLocaleString();
            document.getElementById('advResultScaled').textContent = Math.round(step2).toLocaleString();
            document.getElementById('advResultBuffed').textContent = Math.round(step6).toLocaleString();
            document.getElementById('advResultFinal').textContent = Math.round(step7).toLocaleString();
            document.getElementById('advResultAvg').textContent = Math.round(step8).toLocaleString();
            document.getElementById('advResultDPS').textContent = Math.round(dps).toLocaleString();
            
            document.getElementById('calcBreakdown').innerHTML = breakdown;
        }

        // ============================================
        // ENHANCED TAB SWITCHING
        // ============================================
        var originalSwitchTab = switchTab;
        switchTab = function(tabName) {
            var tabButtons = document.querySelectorAll('.tab-btn');
            for (var i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            event.target.classList.add('active');

            var tabs = ['statsTab', 'weaponsTab', 'bossesTab', 'teamTab', 'advdamageTab'];
            for (var i = 0; i < tabs.length; i++) {
                var tab = document.getElementById(tabs[i]);
                if (tab) tab.classList.remove('active');
            }

            if (tabName === 'stats') {
                document.getElementById('statsTab').classList.add('active');
            } else if (tabName === 'weapons') {
                document.getElementById('weaponsTab').classList.add('active');
                displayWeapons();
                displayRecommendedWeapons();
                populateWeaponSelect();
                syncCalcLevel();
            } else if (tabName === 'bosses') {
                document.getElementById('bossesTab').classList.add('active');
                displayBosses();
                populateBossSelect();
            } else if (tabName === 'team') {
                document.getElementById('teamTab').classList.add('active');
                updateTeamAnalysis();
            } else if (tabName === 'advdamage') {
                document.getElementById('advdamageTab').classList.add('active');
                populateAdvWeaponSelect();
                document.getElementById('advCharLevel').value = currentLevel;
                updateAdvCalc();
            }
        };

        
        // ============================================
        // BUILD ARCHETYPES DATABASE
        // ============================================
        var buildArchetypes = [
            {
                name: "Pure Strength",
                type: "pure",
                description: "Colossal weapons, maximum poise damage, two-handing for 1.5x STR. Pancake everything.",
                stats: "60+ STR, 40 VIG, 30 END. Min DEX for weapon requirements.",
                weapons: ["Giant-Crusher", "Axe of Godfrey", "Grafted Blade Greatsword", "Greatsword", "Prelate's Inferno Crozier"],
                characters: ["Wylder", "Raider", "Guardian"],
                playstyle: "Two-hand weapons for bonus damage. Trade hits with hyper armor. Jump attacks deal massive poise damage. War Cry + charged R2 = delete boss HP bar.",
                tips: "Grafted Blade gives +5 all stats. Stack with Raider's Warlord Totem. Two-handing reaches STR soft cap faster (35 STR = 52.5 effective)."
            },
            {
                name: "Quality Build",
                type: "pure",
                description: "Balanced STR/DEX for maximum weapon variety. Jack of all trades, master of flexibility.",
                stats: "40 STR, 40 DEX, 35 VIG, 25 END. Balanced attribute spread.",
                weapons: ["Bloodhound's Fang", "Greatsword", "Nagakiba", "Zweihander"],
                characters: ["Raider", "Wylder", "Executor"],
                playstyle: "Switch weapons based on boss weakness. Physical damage focused. Can use any melee weapon effectively.",
                tips: "Most versatile build. Great for learning all boss patterns. Pair with status effect Ashes of War for flexibility."
            },
            {
                name: "Pure Dexterity",
                type: "pure",
                description: "Fast weapons, high DPS, katana spam. Roll catches and bleed procs.",
                stats: "60+ DEX, 40 VIG, 25 END. Min STR for weapon requirements.",
                weapons: ["Hand of Malenia", "Nagakiba", "Uchigatana", "Bloodhound's Fang"],
                characters: ["Executor", "Ironeye", "Raider"],
                playstyle: "Fast attack chains. Dual wield katanas for maximum DPS. Dodge attacks, counter with running R1.",
                tips: "DEX increases casting speed slightly. Pair with Seppuku for self-bleed buff. Waterfowl Dance deletes bosses."
            },
            {
                name: "Pure Intelligence",
                type: "pure",
                description: "Glass cannon mage. Comet Azur go brrrr. Delete bosses from safety.",
                stats: "70+ INT, 40 VIG, 40 MIND, 20 END.",
                weapons: ["Lusat's Glintstone Staff", "Carian Regal Scepter", "Dark Moon Greatsword", "Moonveil"],
                characters: ["Recluse", "Revenant"],
                playstyle: "Comet Azur with infinite FP flask = boss melts. Dark Moon Greatsword for melee backup. Stay at range.",
                tips: "Recluse's passive reduces FP cost by 30%. Combine with Terra Magica + Meteorite of Astel for 10k+ damage ults."
            },
            {
                name: "Pure Faith",
                type: "pure",
                description: "Holy damage, incantations, team support. Heal squad, buff damage, smite bosses.",
                stats: "70+ FAI, 40 VIG, 35 MIND, 20 END.",
                weapons: ["Blasphemous Blade", "Sacred Relic Sword", "Maliketh's Black Blade", "Erdtree Seal"],
                characters: ["Duchess", "Guardian", "Revenant"],
                playstyle: "Blasphemous Blade weapon art nukes bosses AND heals you. Incantations for buffs. Support team with heals.",
                tips: "Duchess amplifies healing by 50%. Stack with Blessing's Boon for immortality. Marika's Light full heals team + 60% damage buff."
            },
            {
                name: "Pure Arcane",
                type: "pure",
                description: "Status effect master. Bleed, poison, madness. Proc-based damage ignores resistances.",
                stats: "60+ ARC, 40 VIG, 30 DEX, 25 END.",
                weapons: ["Rivers of Blood", "Mohgwyn's Sacred Spear", "Eleonora's Poleblade", "Dragon Communion Seal"],
                characters: ["Executor", "Revenant"],
                playstyle: "Bleed proc = 20% max HP instant damage. Stack bleed as fast as possible. Rivers of Blood Corpse Piler = 5+ bleed procs in 3 seconds.",
                tips: "Executor's passive increases bleed buildup by 50% AND heals on proc. Broken vs bosses with large HP pools (all Nightlords)."
            },
            {
                name: "Bleed Build",
                type: "status",
                description: "The META. Hemorrhage procs delete boss HP. Works on 95% of enemies.",
                stats: "50 ARC, 40 DEX, 40 VIG, 25 END.",
                weapons: ["Rivers of Blood", "Eleonora's Poleblade", "Mohgwyn's Sacred Spear", "Nagakiba + Seppuku"],
                characters: ["Executor", "Raider"],
                playstyle: "Stack bleed until hemorrhage. Each proc = 20% enemy max HP. Corpse Piler hits 7 times. 3 weapon arts = dead boss.",
                tips: "Raider's Warlord Totem buffs bleed buildup rate. Two Executors with Rivers of Blood = bosses die in under 60 seconds. Caligo fight lasts 45 seconds."
            },
            {
                name: "Frost Build",
                type: "status",
                description: "Slow enemies, reduce defenses. Frost proc = 20% defense down for 30 seconds.",
                stats: "60 INT, 40 VIG, 35 MIND, 20 END.",
                weapons: ["Dark Moon Greatsword", "Helphen's Steeple", "Death's Poker"],
                characters: ["Recluse", "Revenant"],
                playstyle: "Frost proc slows enemies and reduces defense by 20%. Follow up with magic nukes for massive damage.",
                tips: "Dark Moon Greatsword skill applies frost instantly. Pair with Recluse's Comet Azur. Frost + Magic = 50% more damage."
            },
            {
                name: "Poison Build",
                type: "status",
                description: "DOT king. Poison trivializes Adel (vomit lock). Great for Evergaols.",
                stats: "50 ARC, 40 DEX, 40 VIG, 25 END.",
                weapons: ["Serpent Bow", "Antspur Rapier", "Venomous Fang"],
                characters: ["Ironeye", "Executor"],
                playstyle: "Apply poison, kite, let DOT work. Poison proc on Adel = 8 second vomit animation (free DPS window).",
                tips: "Ironeye + Serpent Bow + Poison Arrows = safe poison application from range. Adel becomes a joke. Poison ignores resistances."
            },
            {
                name: "Madness Build",
                type: "status",
                description: "Madness proc = instant stagger + huge damage. PvE viable on certain bosses.",
                stats: "50 ARC, 40 FAI, 40 VIG, 25 END.",
                weapons: ["Vyke's War Spear", "Frenzyflame Seal"],
                characters: ["Raider", "Wylder"],
                playstyle: "Madness buildup staggers enemies. Each proc deals 300+ damage + 5 second stun.",
                tips: "Works on humanoid bosses. Useless vs dragons/beasts. Niche but fun. Frenzyflame incantations boost madness buildup."
            },
            {
                name: "Battlemage (STR/INT)",
                type: "hybrid",
                description: "Melee mage. Ruins Greatsword + sorceries. Gravity magic for crowd control.",
                stats: "40 STR, 50 INT, 35 VIG, 30 MIND, 20 END.",
                weapons: ["Ruins Greatsword", "Starscourge Greatsword", "Moonveil", "Meteorite Staff"],
                characters: ["Wylder", "Recluse", "Raider"],
                playstyle: "Heavy weapon + ranged sorceries. Wave of Destruction for ranged poke. Rock Sling for poise damage.",
                tips: "Ruins Greatsword scales S in STR, B in INT. Best of both worlds. Gravity spells stagger. Radahn cosplay."
            },
            {
                name: "Paladin (STR/FAI)",
                type: "hybrid",
                description: "Holy warrior. Blasphemous Blade + incantations. Heal team, smite bosses.",
                stats: "40 STR, 50 FAI, 40 VIG, 30 MIND, 25 END.",
                weapons: ["Blasphemous Blade", "Maliketh's Black Blade", "Inseparable Sword", "Erdtree Seal"],
                characters: ["Duchess", "Guardian", "Raider"],
                playstyle: "Tank with shields, heal with incantations. Blasphemous Blade weapon art heals on kill. Unkillable.",
                tips: "Duchess' passive makes heals 50% stronger. Blasphemous Blade heals 10% per kill. Stack with Marika's Light ult. Team never dies."
            },
            {
                name: "Spellblade (DEX/INT)",
                type: "hybrid",
                description: "Weeb perfection. Moonveil + sorceries. Fast katana + magic nukes.",
                stats: "40 DEX, 50 INT, 35 VIG, 35 MIND, 20 END.",
                weapons: ["Moonveil", "Dark Moon Greatsword", "Wing of Astel", "Carian Regal Scepter"],
                characters: ["Executor", "Recluse"],
                playstyle: "Moonveil Transient Moonlight spam. Follow up with Comet Azur. Fast melee with magic backup.",
                tips: "Moonveil weapon art is fast and costs low FP. Spam it. Recluse reduces FP cost. Infinite magic slashes."
            },
            {
                name: "Death Knight (INT/FAI)",
                type: "hybrid",
                description: "Dual caster. Death sorceries + incantations. Best for Revenant.",
                stats: "40 INT, 40 FAI, 40 VIG, 40 MIND, 20 END.",
                weapons: ["Sword of Night and Flame", "Death's Poker", "Prince of Death's Staff", "Golden Order Seal"],
                characters: ["Revenant", "Duchess", "Recluse"],
                playstyle: "Sword of Night and Flame has dual stance. Comet Azur beam OR Flame Sweep. Ancient Death Rancor for DOT.",
                tips: "Revenant gets bonus to death sorceries. Ancient Death Rancor + summons = bosses surrounded. Chaos."
            }
        ];

        var currentArchetypeFilter = 'all';

        // ============================================
        // RELICS DATABASE
        // ============================================
        var relics = {
            high: [
                {
                    name: "Dragon's Fury",
                    effect: "+30% Fire damage. Fire attacks ignore 20% of enemy resistance.",
                    synergy: "Essential for Caligo (frost dragon). Perfect for Duchess, Wylder with Blasphemous Blade."
                },
                {
                    name: "Storm Herald",
                    effect: "+30% Lightning damage. Lightning procs stagger 100% faster.",
                    synergy: "MANDATORY for Fulghor (only weak to lightning). Ironeye + Bolt of Gransax becomes unstoppable."
                },
                {
                    name: "Bloodletter's Crown",
                    effect: "+50% Bleed buildup. Hemorrhage procs restore 5% HP.",
                    synergy: "Executor's best friend. Rivers of Blood becomes even more broken. Stacks with Executor passive."
                },
                {
                    name: "Warlord's Banner",
                    effect: "Team damage +20%. Stacks with Raider's buffs.",
                    synergy: "Mandatory for Raider. Warlord Totem (1.6x) + Banner (1.2x) = 1.92x team damage. Insane."
                },
                {
                    name: "Lifebinder's Grace",
                    effect: "+100% healing effectiveness. Heals remove all status ailments.",
                    synergy: "Duchess becomes immortal. Marika's Light heals to max HP + full cleanse + damage buff. OP."
                }
            ],
            medium: [
                {
                    name: "Frostweaver's Mantle",
                    effect: "+25% Frost buildup. Frost proc slows enemies 40%.",
                    synergy: "Strong for Recluse with Dark Moon Greatsword. Slowed bosses = easier dodges."
                },
                {
                    name: "Arcane Amplifier",
                    effect: "+15% damage for every unique status effect on enemy.",
                    synergy: "Executor can stack bleed + poison. Revenant can stack frost + death. Multi-status builds."
                },
                {
                    name: "Ironclad Resolve",
                    effect: "+40% Poise. Cannot be staggered while attacking.",
                    synergy: "Guardian becomes true tank. Trade hits without flinching. Pair with colossal shields."
                },
                {
                    name: "Quickstep Charm",
                    effect: "Dodge roll has 50% more i-frames. -20% stamina cost.",
                    synergy: "Any character benefits. Especially good for learning new bosses. Safety first."
                },
                {
                    name: "Summon Extender",
                    effect: "Spirit summons last 100% longer. +40% summon damage.",
                    synergy: "Revenant's best relic. Army of the Fell lasts 90 seconds. Bosses fight an army."
                }
            ],
            low: [
                {
                    name: "Rune Magnet",
                    effect: "+40% runes from all sources. Kills grant runes to all team members.",
                    synergy: "Raider already has Pillage passive. Stack for maximum runes. Farming relic."
                },
                {
                    name: "Sleep Resistance Ring",
                    effect: "Immune to Sleep buildup. Sleep clouds deal no damage.",
                    synergy: "Situational for Augur fight only. Otherwise useless."
                },
                {
                    name: "Poison Immunity Amulet",
                    effect: "Cannot be poisoned. Poison clouds ignored.",
                    synergy: "Useful for Adel fight. Otherwise skip."
                },
                {
                    name: "Madness Ward",
                    effect: "+90% Madness resistance. Madness buildup 80% slower.",
                    synergy: "Libra fight only. Lets you stand in golden circles briefly."
                },
                {
                    name: "Death's Defiance",
                    effect: "Survive lethal damage once per expedition. Restore to 50% HP.",
                    synergy: "Safety net. Good for learning. Veterans don't need it."
                }
            ]
        };

        // ============================================
        // ARCHETYPE FUNCTIONS
        // ============================================
        function filterArchetypes(type) {
            currentArchetypeFilter = type;
            
            var buttons = document.querySelectorAll('.archetype-filter .filter-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            event.target.classList.add('active');
            
            displayArchetypes();
        }

        function displayArchetypes() {
            var filtered = buildArchetypes.filter(function(build) {
                return currentArchetypeFilter === 'all' || build.type === currentArchetypeFilter;
            });
            
            var html = '';
            for (var i = 0; i < filtered.length; i++) {
                var build = filtered[i];
                var weaponsHTML = '';
                for (var j = 0; j < build.weapons.length; j++) {
                    weaponsHTML += '<span class="weapon-chip">' + build.weapons[j] + '</span>';
                }
                
                var charsHTML = build.characters.join(', ');
                
                html += '<div class="archetype-card">' +
                    '<div class="archetype-header">' +
                        '<div class="archetype-name">' + build.name + '</div>' +
                        '<div class="archetype-type">' + build.type.toUpperCase() + '</div>' +
                    '</div>' +
                    '<div class="archetype-description">' + build.description + '</div>' +
                    '<div class="archetype-details">' +
                        '<div class="archetype-section">' +
                            '<div class="archetype-label"> Stat Distribution</div>' +
                            '<div class="archetype-content">' + build.stats + '</div>' +
                        '</div>' +
                        '<div class="archetype-section">' +
                            '<div class="archetype-label"> Key Weapons</div>' +
                            '<div class="archetype-weapons">' + weaponsHTML + '</div>' +
                        '</div>' +
                        '<div class="archetype-section">' +
                            '<div class="archetype-label"> Best Characters</div>' +
                            '<div class="archetype-content">' + charsHTML + '</div>' +
                        '</div>' +
                        '<div class="archetype-section">' +
                            '<div class="archetype-label"> Playstyle</div>' +
                            '<div class="archetype-content">' + build.playstyle + '</div>' +
                        '</div>' +
                        '<div class="archetype-section">' +
                            '<div class="archetype-label"> Pro Tips</div>' +
                            '<div class="archetype-content">' + build.tips + '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            }
            
            document.getElementById('archetypeGrid').innerHTML = html;
        }

        // ============================================
        // RELICS FUNCTIONS
        // ============================================
        function displayRelics() {
            // High Priority
            var highHTML = '';
            for (var i = 0; i < relics.high.length; i++) {
                var r = relics.high[i];
                highHTML += '<div class="relic-item">' +
                    '<div class="relic-name">' + r.name + '</div>' +
                    '<div class="relic-effect">' + r.effect + '</div>' +
                    '<div class="relic-synergy"><strong>Synergy:</strong> ' + r.synergy + '</div>' +
                '</div>';
            }
            document.getElementById('highPriorityRelics').innerHTML = highHTML;
            
            // Medium Priority
            var medHTML = '';
            for (var i = 0; i < relics.medium.length; i++) {
                var r = relics.medium[i];
                medHTML += '<div class="relic-item">' +
                    '<div class="relic-name">' + r.name + '</div>' +
                    '<div class="relic-effect">' + r.effect + '</div>' +
                    '<div class="relic-synergy"><strong>Synergy:</strong> ' + r.synergy + '</div>' +
                '</div>';
            }
            document.getElementById('mediumPriorityRelics').innerHTML = medHTML;
            
            // Low Priority
            var lowHTML = '';
            for (var i = 0; i < relics.low.length; i++) {
                var r = relics.low[i];
                lowHTML += '<div class="relic-item">' +
                    '<div class="relic-name">' + r.name + '</div>' +
                    '<div class="relic-effect">' + r.effect + '</div>' +
                    '<div class="relic-synergy"><strong>Synergy:</strong> ' + r.synergy + '</div>' +
                '</div>';
            }
            document.getElementById('lowPriorityRelics').innerHTML = lowHTML;
        }

        // ============================================
        // COMPARISON FUNCTIONS
        // ============================================
        function updateComparison() {
            var char1Id = document.getElementById('compare1').value;
            var char2Id = document.getElementById('compare2').value;
            var compLevel = parseInt(document.getElementById('compareLevel').value);
            
            document.getElementById('compareLevelDisplay').textContent = 'Level ' + compLevel;
            
            var char1 = characters[char1Id];
            var char2 = characters[char2Id];
            
            // Calculate stats at comparison level
            var stats1 = calculateAllStats(char1, compLevel);
            var stats2 = calculateAllStats(char2, compLevel);
            
            // Build comparison table
            var html = '<div class="comparison-table">' +
                '<div class="comparison-row header">' +
                    '<div class="comparison-cell">Stat</div>' +
                    '<div class="comparison-cell">' + char1.name + '</div>' +
                    '<div class="comparison-cell">' + char2.name + '</div>' +
                '</div>';
            
            var statLabels = {
                hp: 'Health Points',
                fp: 'Focus Points',
                stamina: 'Stamina',
                vigor: 'Vigor',
                mind: 'Mind',
                endurance: 'Endurance',
                strength: 'Strength',
                dexterity: 'Dexterity',
                intelligence: 'Intelligence',
                faith: 'Faith',
                arcane: 'Arcane'
            };
            
            for (var stat in statLabels) {
                var val1 = stats1[stat];
                var val2 = stats2[stat];
                var winner1 = val1 > val2 ? ' winner' : '';
                var winner2 = val2 > val1 ? ' winner' : '';
                
                html += '<div class="comparison-row">' +
                    '<div class="comparison-cell label">' + statLabels[stat] + '</div>' +
                    '<div class="comparison-cell value' + winner1 + '">' + val1 + '</div>' +
                    '<div class="comparison-cell value' + winner2 + '">' + val2 + '</div>' +
                '</div>';
            }
            
            html += '</div>';
            
            // Add stat bars visualization
            html += '<div class="stat-bars-comparison">';
            
            for (var stat in statLabels) {
                var val1 = stats1[stat];
                var val2 = stats2[stat];
                var max = Math.max(val1, val2);
                var pct1 = (val1 / max * 100);
                var pct2 = (val2 / max * 100);
                
                html += '<div class="stat-comparison-item">' +
                    '<div class="stat-comparison-label">' +
                        '<span>' + statLabels[stat] + '</span>' +
                        '<span>' + val1 + ' vs ' + val2 + '</span>' +
                    '</div>' +
                    '<div class="stat-comparison-bars">' +
                        '<div class="stat-comparison-bar">' +
                            '<div class="stat-comparison-fill" style="width:' + pct1 + '%">' + val1 + '</div>' +
                        '</div>' +
                        '<div class="stat-comparison-bar">' +
                            '<div class="stat-comparison-fill" style="width:' + pct2 + '%">' + val2 + '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            }
            
            html += '</div>';
            
            document.getElementById('comparisonDisplay').innerHTML = html;
        }

        function calculateAllStats(char, level) {
            var levelsGained = level - 1;
            
            return {
                hp: Math.round(char.hp.base + (levelsGained * 20 * scalingMultipliers[char.hp.scaling])),
                fp: Math.round(char.fp.base + (levelsGained * 3 * scalingMultipliers[char.fp.scaling])),
                stamina: Math.round(char.stamina.base + (levelsGained * 2 * scalingMultipliers[char.stamina.scaling])),
                vigor: calculateAttribute(char.stats.vigor),
                mind: calculateAttribute(char.stats.mind),
                endurance: calculateAttribute(char.stats.endurance),
                strength: calculateAttribute(char.stats.strength),
                dexterity: calculateAttribute(char.stats.dexterity),
                intelligence: calculateAttribute(char.stats.intelligence),
                faith: calculateAttribute(char.stats.faith),
                arcane: calculateAttribute(char.stats.arcane)
            };
        }

        // ============================================
        // ENHANCED TAB SWITCHING (FINAL VERSION)
        // ============================================
        switchTab = function(tabName) {
            var tabButtons = document.querySelectorAll('.tab-btn');
            for (var i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            event.target.classList.add('active');

            var tabs = ['statsTab', 'weaponsTab', 'bossesTab', 'teamTab', 'advdamageTab', 'archetypesTab', 'relicsTab', 'compareTab'];
            for (var i = 0; i < tabs.length; i++) {
                var tab = document.getElementById(tabs[i]);
                if (tab) tab.classList.remove('active');
            }

            if (tabName === 'stats') {
                document.getElementById('statsTab').classList.add('active');
            } else if (tabName === 'weapons') {
                document.getElementById('weaponsTab').classList.add('active');
                displayWeapons();
                displayRecommendedWeapons();
                populateWeaponSelect();
                syncCalcLevel();
            } else if (tabName === 'bosses') {
                document.getElementById('bossesTab').classList.add('active');
                displayBosses();
                populateBossSelect();
            } else if (tabName === 'team') {
                document.getElementById('teamTab').classList.add('active');
                updateTeamAnalysis();
            } else if (tabName === 'advdamage') {
                document.getElementById('advdamageTab').classList.add('active');
                populateAdvWeaponSelect();
                document.getElementById('advCharLevel').value = currentLevel;
                updateAdvCalc();
            } else if (tabName === 'archetypes') {
                document.getElementById('archetypesTab').classList.add('active');
                displayArchetypes();
            } else if (tabName === 'relics') {
                document.getElementById('relicsTab').classList.add('active');
                displayRelics();
            } else if (tabName === 'compare') {
                document.getElementById('compareTab').classList.add('active');
                updateComparison();
            }
        };

        window.onload = init;
    </script>
</body>
</html>